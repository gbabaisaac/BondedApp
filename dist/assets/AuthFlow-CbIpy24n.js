import{j as e,r as c}from"./radix-vendor-D14C15Ff.js";import{c as w,C as D,a as L,b as P,d as T,e as U,B as _,g as F,p as B,f as J}from"./index-M3q6TuVL.js";import{I as h}from"./input-D1hZyrkL.js";import{L as x}from"./label-bXuO2QpB.js";import{a as M}from"./ui-vendor-BZRxtcfS.js";import{U as W,M as $,L as q,C as O}from"./icons-vendor-DY0DtMnS.js";import"./supabase-vendor-BE7OkBLE.js";import"./react-vendor-B2m46t8p.js";const z=M("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function V({className:o,variant:a,...d}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:w(z({variant:a}),o),...d})}function H({className:o,...a}){return e.jsx("div",{"data-slot":"alert-description",className:w("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",o),...a})}const j=F();function te({onAuthSuccess:o}){const[a,d]=c.useState("login"),[i,N]=c.useState(""),[u,b]=c.useState(""),[v,S]=c.useState(""),[m,l]=c.useState(""),[f,p]=c.useState(!1),C=r=>{try{const s=r.split("@")[1];if(!s)return"TestUniversity";const t=s.replace(".edu","").split(".").slice(-2,-1)[0];return t?t.charAt(0).toUpperCase()+t.slice(1):"TestUniversity"}catch{return"TestUniversity"}},k=async r=>{r.preventDefault(),l(""),p(!0);try{const s=i.includes(".edu")?C(i):"University",t=await fetch(`https://${B}.supabase.co/functions/v1/make-server-2516be19/signup`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${J}`},body:JSON.stringify({email:i,password:u,name:v,school:s})});if(!t.ok){let n="Signup failed";try{n=(await t.json()).error||n,(n.includes("already been registered")||n.includes("email_exists"))&&(n="This email is already registered. Please sign in instead.")}catch{const E=await t.text();console.error("Non-JSON error response:",E),t.status===404?n="Service unavailable. Please try again in a moment.":n=`Server error (${t.status}): ${t.statusText}`}throw new Error(n)}const K=await t.json(),{data:g,error:y}=await j.auth.signInWithPassword({email:i,password:u});if(y)throw y;g.session&&o(g.session.access_token,g.user.id)}catch(s){console.error("Signup error:",s),l(s.message||"An error occurred during signup")}finally{p(!1)}},I=async r=>{r.preventDefault(),l(""),p(!0),console.log("Attempting login with:",i);try{console.log("Calling Supabase signInWithPassword...");const{data:s,error:t}=await j.auth.signInWithPassword({email:i,password:u});if(console.log("Supabase response:",{data:s,error:t}),t)throw console.error("Sign in error:",t),t;if(s.session)console.log("Login successful, calling onAuthSuccess"),o(s.session.access_token,s.user.id);else throw new Error("No session returned from login")}catch(s){console.error("Login error:",s),l(s.message||"Invalid email or password")}finally{p(!1)}};return e.jsx("div",{className:"min-h-screen p-4 py-8 pb-24",children:e.jsx("div",{className:"w-full max-w-md mx-auto space-y-4",children:e.jsxs(D,{className:"w-full",children:[e.jsxs(L,{className:"text-center space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx("img",{src:"/Bonded_transparent_icon.png",alt:"bonded logo",className:"w-12 h-12"}),e.jsx("h1",{className:"text-4xl text-[#1E4F74] lowercase font-bold tracking-wide",children:"bonded"})]}),e.jsx(P,{children:a==="login"?"Welcome Back":"Join bonded"}),e.jsx(T,{children:a==="login"?"Sign in to connect with your campus community":"Create your account to get started"})]}),e.jsx(U,{children:e.jsxs("form",{onSubmit:a==="login"?I:k,className:"space-y-4",children:[a==="signup"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(h,{id:"name",type:"text",placeholder:"John Doe",value:v,onChange:r=>S(r.target.value),required:!0,className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(h,{id:"email",type:"email",placeholder:"your.email@example.com",value:i,onChange:r=>N(r.target.value),required:!0,className:"pl-10"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use any email for testing (.edu validation disabled)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(h,{id:"password",type:"password",placeholder:"••••••••",value:u,onChange:r=>b(r.target.value),required:!0,className:"pl-10",minLength:6})]})]}),m&&e.jsxs(V,{variant:"destructive",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:m}),m.includes("Invalid")&&e.jsx("p",{className:"text-xs",children:`Tip: If you haven't created test accounts yet, click "Show test accounts" or the setup link below.`}),m.includes("already registered")&&a==="signup"&&e.jsx("button",{type:"button",onClick:()=>{d("login"),l("")},className:"text-xs underline mt-1 text-white hover:text-gray-200",children:"Click here to sign in instead"})]})})]}),e.jsx(_,{type:"submit",className:"w-full",disabled:f,children:f?"Please wait...":a==="login"?"Sign In":"Create Account"}),e.jsx("div",{className:"text-center space-y-2",children:e.jsx("button",{type:"button",onClick:()=>{d(a==="login"?"signup":"login"),l("")},className:"text-sm text-blue-600 hover:underline block w-full",children:a==="login"?"Don't have an account? Sign up":"Already have an account? Sign in"})})]})})]})})})}export{te as AuthFlow};
