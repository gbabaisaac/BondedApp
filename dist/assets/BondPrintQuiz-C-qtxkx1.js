import{j as e,m as i,H as B,g as F,C as N,L as v,d as k,a as Q}from"./ui-vendor-D_t-keVG.js";import{r as l}from"./react-vendor-VqAh-rcM.js";import{e as W,C as T,f as O,B as u,b as o,p as h}from"./index-BYJfFurX.js";import"./supabase-vendor-l2BGu7mn.js";function L({onComplete:S,onSkip:g,userProfile:x,accessToken:A}){const c=A||W.getState().accessToken,[z,E]=l.useState(!1),[d,f]=l.useState(!1),[t,p]=l.useState(null),[a,b]=l.useState(null),[m,y]=l.useState(!1),[C,j]=l.useState(!1),P=async()=>{if(!x||!x.name){o.error("Profile information is missing. Please complete your profile first.");return}if(!c){o.error("Please log in to start the quiz.");return}f(!0);try{const s=await fetch(`https://${h}.supabase.co/functions/v1/make-server-2516be19/bond-print/start`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({userProfile:x})});if(!s.ok){const n=await s.json();throw console.error("Quiz start failed:",n),new Error(n.error||"Failed to start quiz")}const r=await s.json();p(r),E(!0)}catch(s){console.error("Error starting quiz:",s),o.error(s.message||"Failed to start quiz. Please try again.")}finally{f(!1)}},D=async()=>{if(!(!a||!t)){y(!0);try{const s=await fetch(`https://${h}.supabase.co/functions/v1/make-server-2516be19/bond-print/answer`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({answer:a,questionText:t.question})});if(!s.ok){const n=await s.json();throw console.error("Answer submission failed:",n),new Error(n.error||"Failed to submit answer")}const r=await s.json();b(null),r.completed?await q():p(r)}catch(s){console.error("Error submitting answer:",s),o.error(s.message||"Failed to submit answer. Please try again.")}finally{y(!1)}}},q=async()=>{j(!0);try{const s=await fetch(`https://${h}.supabase.co/functions/v1/make-server-2516be19/bond-print/generate`,{method:"POST",headers:{Authorization:`Bearer ${c}`}});if(!s.ok){const n=await s.json();throw console.error("Bond Print generation failed:",n),new Error(n.error||"Failed to generate Bond Print")}const r=await s.json();o.success("Your Bond Print is ready! ðŸŽ‰"),S(r.bondPrint)}catch(s){console.error("Error generating Bond Print:",s),o.error(s.message||"Failed to generate Bond Print. Please try again."),j(!1)}};if(!z)return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-6",style:{background:"linear-gradient(135deg, #F3F4FF 0%, #FFE5EC 50%, #FFF5E6 100%)",minHeight:"-webkit-fill-available"},children:e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md mx-auto",children:e.jsx(T,{className:"bg-white/95 backdrop-blur-xl shadow-2xl border-none",style:{borderRadius:"28px",padding:"40px 32px"},children:e.jsxs(O,{className:"p-0",children:[e.jsx(i.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",style:{background:"linear-gradient(135deg, #FF6B6B 0%, #A78BFA 100%)",boxShadow:"0 8px 24px rgba(255, 107, 107, 0.3)"},children:e.jsx(B,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-center mb-3",style:{fontSize:"28px",fontWeight:"700",color:"#1A1D2E",letterSpacing:"-0.02em"},children:"Create Your Bond Print"}),e.jsx("p",{className:"text-center mb-8",style:{color:"#6B6B6B",fontSize:"16px",lineHeight:"1.6"},children:"Quick quiz for personalized matches"}),e.jsxs("div",{className:"flex items-center justify-around mb-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"rgba(255, 107, 107, 0.1)"},children:e.jsx(F,{className:"w-6 h-6",style:{color:"#FF6B6B"}})}),e.jsx("span",{style:{fontSize:"13px",color:"#6B6B6B",fontWeight:"600"},children:"AI Match"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"rgba(167, 139, 250, 0.1)"},children:e.jsx(B,{className:"w-6 h-6",style:{color:"#A78BFA"}})}),e.jsx("span",{style:{fontSize:"13px",color:"#6B6B6B",fontWeight:"600"},children:"Compatible"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center",style:{background:"rgba(96, 165, 250, 0.1)"},children:e.jsx(N,{className:"w-6 h-6",style:{color:"#60A5FA"}})}),e.jsx("span",{style:{fontSize:"13px",color:"#6B6B6B",fontWeight:"600"},children:"3 min"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i.div,{whileTap:{scale:d?1:.98},children:e.jsx(u,{onClick:P,disabled:d,className:"w-full text-white border-none shadow-lg",size:"lg",style:{height:"56px",borderRadius:"16px",background:d?"#D1D5DB":"linear-gradient(135deg, #FF6B6B 0%, #A78BFA 100%)",fontSize:"17px",fontWeight:"700"},children:d?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-5 h-5 animate-spin mr-2"}),"Preparing..."]}):e.jsxs(e.Fragment,{children:["Start Quiz",e.jsx(k,{className:"w-5 h-5 ml-2"})]})})}),g&&e.jsx(u,{onClick:g,variant:"ghost",className:"w-full",style:{height:"48px",color:"#6B6B6B",fontSize:"15px",fontWeight:"600"},children:"Skip for now"})]})]})})})});if(C)return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, #F3F4FF 0%, #FFE5EC 50%, #FFF5E6 100%)",height:"100dvh",WebkitOverflowScrolling:"touch"},children:e.jsxs(i.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6",style:{background:"linear-gradient(135deg, #FF6B6B 0%, #A78BFA 100%)",boxShadow:"0 8px 24px rgba(255, 107, 107, 0.3)"},children:e.jsx(F,{className:"w-12 h-12 text-white animate-pulse"})}),e.jsx("h2",{className:"text-2xl mb-3",style:{color:"#1A1D2E",fontWeight:"700"},children:"Analyzing Your Responses..."}),e.jsx("p",{style:{color:"#6B6B6B",marginBottom:"16px"},children:"Creating your unique Bond Print"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full animate-bounce",style:{background:"#FF6B6B",animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full animate-bounce",style:{background:"#A78BFA",animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full animate-bounce",style:{background:"#FF6B6B",animationDelay:"300ms"}})]})]})});if(!t)return null;const w=t.questionNumber/t.totalQuestions*100;return e.jsx("div",{className:"fixed inset-0 overflow-y-auto p-6",style:{background:"linear-gradient(135deg, #F3F4FF 0%, #FFE5EC 50%, #FFF5E6 100%)",height:"100dvh",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y"},children:e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-xl w-full mx-auto",style:{paddingTop:"40px",paddingBottom:"40px"},children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-xl shadow-2xl",style:{borderRadius:"28px",padding:"32px 24px"},children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-semibold",style:{color:"#6B6B6B"},children:["Question ",t.questionNumber," of ",t.totalQuestions]}),e.jsxs("span",{className:"text-sm font-bold",style:{color:"#FF6B6B",background:"rgba(255, 107, 107, 0.1)",padding:"4px 12px",borderRadius:"12px"},children:[Math.round(w),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full overflow-hidden",style:{background:"#E8E8F0"},children:e.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${w}%`,background:"linear-gradient(135deg, #FF6B6B 0%, #A78BFA 100%)"}})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl leading-relaxed mb-6",style:{color:"#1A1D2E",fontWeight:"700",fontSize:"20px",lineHeight:"1.4"},children:t.question}),e.jsx("div",{className:"space-y-3",children:e.jsx(Q,{mode:"wait",children:t.options.map((s,r)=>e.jsx(i.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.05},onClick:()=>b(s),className:"w-full text-left p-4 rounded-2xl transition-all",style:{background:a===s?"rgba(255, 107, 107, 0.1)":"rgba(248, 249, 250, 0.8)",border:a===s?"2px solid #FF6B6B":"2px solid transparent",boxShadow:a===s?"0 4px 12px rgba(255, 107, 107, 0.15)":"none"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 transition-all",style:{borderColor:a===s?"#FF6B6B":"#D1D5DB",background:a===s?"#FF6B6B":"transparent"},children:a===s&&e.jsx(N,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:"leading-relaxed",style:{color:a===s?"#1A1D2E":"#6B6B6B",fontWeight:a===s?"600":"400",fontSize:"15px"},children:s})]})},s))})})]}),e.jsx(u,{onClick:D,disabled:!a||m,className:"w-full text-white border-none shadow-lg",size:"lg",style:{height:"56px",borderRadius:"16px",background:!a||m?"#D1D5DB":"linear-gradient(135deg, #FF6B6B 0%, #A78BFA 100%)",fontSize:"17px",fontWeight:"700"},children:m?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-5 h-5 animate-spin mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[t.questionNumber===t.totalQuestions?"Finish Quiz":"Next Question",e.jsx(k,{className:"w-5 h-5 ml-2"})]})})]})},t.questionNumber)})}export{L as BondPrintQuiz};
