import{r as d,j as e,b as Cs,C as As,c as Es,T as Is,D as Bs,P as Fs,O as rs,d as Ls,I as $s,e as Ms,f as Rs,g as zs,h as Ts,i as Ds,V as _s,k as Ps,l as Os,m as Us,n as Gs,o as qs,p as Vs,q as Hs,s as Ys,t as Ws,u as Js,F as Ks,v as Qs,w as Zs,x as Xs}from"./radix-vendor-D14C15Ff.js";import{i as et,g as je,j as Ue,U as st,a as O,X as be,k as fe,l as tt,F as at,m as ls,n as Ge,o as nt,E as it,p as rt,q as lt,I as os,H as te,r as cs,d as Re,s as ot,S as ds,t as ct,u as dt,v as mt,w as ht,A as xe,x as Ke,y as xt,z as ut,B as pt,D as De,J as Qe,K as gt,N as ft,C as jt,P as Ze,O as bt,Q as vt,T as Xe,b as yt,G as Nt,W as ms,M as wt,V as kt,Y as St,f as Ct,e as At,Z as Et,L as Ee,_ as hs,$ as It,a0 as _e,h as Bt,a1 as Pe,a2 as es,a3 as Ft}from"./icons-vendor-DY0DtMnS.js";import{i as Lt,u as xs,h as $t,M as Mt,j as Rt,k as zt,l as Tt,n as Te,B as y,p as W,c as J,m as Y,C as S,e as G,_ as Dt,o as Fe,q as ss,r as _t}from"./index-M3q6TuVL.js";import{B as K}from"./badge-CnwWpSLx.js";import{b as C}from"./ui-vendor-BZRxtcfS.js";import{T as Oe}from"./textarea-C2zb-GuH.js";import{L as H}from"./label-bXuO2QpB.js";import{i as Pt}from"./offline-B_cCa4Xs.js";import{I as X}from"./input-D1hZyrkL.js";import{P as oe}from"./progress-BDyDl-qk.js";import{A as Ie}from"./index-CppVJ9fv.js";import"./supabase-vendor-BE7OkBLE.js";import"./react-vendor-B2m46t8p.js";function Ot(...s){const t=!Array.isArray(s[0]),a=t?0:-1,l=s[0+a],r=s[1+a],h=s[2+a],i=s[3+a],o=Lt(r,h,i);return t?o(l):o}function us(s){const t=xs(()=>$t(s)),{isStatic:a}=d.useContext(Mt);if(a){const[,l]=d.useState(s);d.useEffect(()=>t.on("change",l),[])}return t}function ps(s,t){const a=us(t()),l=()=>a.set(t());return l(),Rt(()=>{const r=()=>zt.preRender(l,!1,!0),h=s.map(i=>i.on("change",r));return()=>{h.forEach(i=>i()),Tt(l)}}),a}function Ut(s){Te.current=[],s();const t=ps(Te.current,s);return Te.current=void 0,t}function ts(s,t,a,l){if(typeof s=="function")return Ut(s);const r=typeof t=="function"?t:Ot(t,a,l);return Array.isArray(s)?as(s,r):as([s],([h])=>r(h))}function as(s,t){const a=xs(()=>[]);return ps(s,()=>{a.length=0;const l=s.length;for(let r=0;r<l;r++)a[r]=s[r].get();return t(a)})}const gs="https://wmlklvlnxftedtylgxsc.supabase.co",Q=gs.replace("https://","").replace(".supabase.co","");console.warn("âš ï¸ Supabase configuration missing. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in .env file");const Ae={CHAT_COUNTS:1e4,TYPING_STATUS:2e3,MESSAGES:5e3},Gt={MAX_PARALLEL_CHECKS:10,BATCH_SIZE:10},qt=Object.freeze(Object.defineProperty({__proto__:null,BOND_PRINT_LIMITS:Gt,POLL_INTERVALS:Ae},Symbol.toStringTag,{value:"Module"}));function Vt({children:s,activeTab:t,onTabChange:a,accessToken:l,hideNavigation:r=!1,onUnreadCountChange:h}){const[i,o]=d.useState(0),[x,u]=d.useState(0);d.useEffect(()=>{if(l){k();const c=setInterval(k,Ae.CHAT_COUNTS);return()=>clearInterval(c)}},[l]),d.useEffect(()=>{h&&h(x)},[x,h]);const k=async()=>{if(l)try{const c=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/soft-intros/incoming`,{headers:{Authorization:`Bearer ${l}`}});if(c.ok){const L=(await c.json()).filter($=>$.status==="pending");o(L.length)}const j=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chats`,{headers:{Authorization:`Bearer ${l}`}});if(j.ok){const L=(await j.json()).reduce(($,U)=>$+(U.unreadCount||0),0);u(L)}}catch{}};d.useEffect(()=>(window.__refreshNavCounts=k,()=>{delete window.__refreshNavCounts}),[l]);const E=[{id:"discover",icon:et,label:"Discover",badge:0},{id:"matches",icon:je,label:"Connections",badge:i},{id:"messages",icon:Ue,label:"Messages",badge:x},{id:"profile",icon:st,label:"Profile",badge:0}];return e.jsxs("div",{className:"h-full flex flex-col bg-white",style:{height:"100%",position:"relative"},children:[e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",paddingBottom:"calc(4rem + env(safe-area-inset-bottom))"},children:s}),!r&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:e.jsx("div",{className:"flex items-center justify-around h-16 px-2",children:E.map(c=>{const j=c.icon,I=t===c.id;return e.jsx("button",{onClick:()=>a(c.id),className:`flex flex-col items-center justify-center flex-1 h-full transition-colors relative ${I?"text-[#2E7B91]":"text-[#64748b]"}`,children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:`w-6 h-6 ${I?"fill-[#2E7B91]":""}`}),c.badge>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-semibold rounded-full w-5 h-5 flex items-center justify-center",children:c.badge>9?"9+":c.badge})]})},c.id)})})})]})}function Ht({profile:s,onClose:t,currentUserName:a="You",accessToken:l}){const[r,h]=d.useState("reason"),[i,o]=d.useState(""),[x,u]=d.useState(null),[k,E]=d.useState(!1),[c,j]=d.useState(!1),I=[{value:"friends",label:"ðŸ‘‹ Make Friends",description:"Looking to connect and hang out"},{value:"roommate",label:"ðŸ  Find a Roommate",description:"Searching for someone to live with"},{value:"study",label:"ðŸ“š Study Together",description:"Need a study buddy or group"},{value:"collaborate",label:"ðŸ’¡ Collaborate",description:"Work on projects together"},{value:"network",label:"ðŸ¤ Network",description:"Professional connections"}],L=async T=>{o(T),h("ai-analysis");const p=await $(T);p&&u(p)},$=async T=>{if(!l)return C.error("You must be logged in"),null;j(!0);try{const p=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/soft-intro/generate-ai-analysis`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({toUserId:s.id,reason:T.toLowerCase().replace(/\s+/g,"-")})});if(!p.ok){if(p.status===404)throw console.error("Endpoint not found - Edge Function may need to be deployed"),new Error("Service temporarily unavailable. Please try again in a moment.");const b=await p.json().catch(()=>({error:"Unknown error"}));if(console.error("API error response:",b),b.analysis&&b.score){const F=b.score>=85?"Excellent":b.score>=70?"Great":"Good";return{similarities:b.highlights||[],compatibility:F,recommendation:b.analysis,score:b.score}}throw new Error(b.error||"Failed to generate AI analysis")}const f=await p.json();if(!f||!f.analysis&&!f.score)throw console.warn("Invalid response data, using fallback"),new Error("Invalid response format");const B=f.score>=85?"Excellent":f.score>=70?"Great":"Good";return{similarities:f.highlights||[],compatibility:B,recommendation:f.analysis||"You seem like a great match!",score:f.score||75}}catch(p){return console.error("AI analysis error:",p),console.error("Error details:",p.message),p.message?.includes("fallback")||C.error("Using basic compatibility analysis"),{similarities:["Potential for meaningful connection"],compatibility:"Good",recommendation:`You and ${s.name.split(" ")[0]} seem like a great match!`,score:70}}finally{j(!1)}},U=async()=>{if(!l){C.error("You must be logged in to send an intro");return}E(!0);try{if(!(await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/soft-intro`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({toUserId:s.id,reason:i,analysis:x?{score:x.score,highlights:x.similarities,analysis:x.recommendation}:null})})).ok)throw new Error("Failed to send intro");h("success"),setTimeout(()=>{C.success(`Soft intro sent to ${s.name}!`,{description:"They'll receive a notification and can choose to connect with you."}),t()},2e3)}catch(T){console.error("Error sending intro:",T),C.error("Failed to send intro. Please try again."),E(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center",children:e.jsxs("div",{className:"bg-white w-full sm:max-w-md sm:rounded-2xl rounded-t-3xl flex flex-col",style:{maxHeight:"90dvh",height:"90dvh"},children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between rounded-t-3xl flex-shrink-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-[#2E7B91]"}),e.jsx("h2",{className:"text-lg",children:"Soft Intro"})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden min-h-0",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",paddingBottom:"calc(6rem + env(safe-area-inset-bottom))",WebkitTransform:"translateZ(0)",transform:"translateZ(0)"},children:e.jsxs("div",{className:"p-6 pb-12",children:[r==="reason"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl mb-2",children:["Why do you want to connect with ",s.name.split(" ")[0],"?"]}),e.jsx("p",{className:"text-sm text-[#475569] mb-6",children:"Our AI will analyze your compatibility and create a personalized introduction."}),e.jsx("div",{className:"space-y-3 pb-4",children:I.map(T=>e.jsx("button",{onClick:()=>L(T.value),className:"w-full text-left p-4 border-2 border-[#EAEAEA] rounded-2xl hover:border-[#2E7B91] hover:bg-[#2E7B9115] active:bg-[#2E7B9120] transition-all touch-manipulation",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium mb-1 text-[#1E4F74]",children:T.label}),e.jsx("p",{className:"text-sm text-[#475569]",children:T.description})]})})},T.value))})]}),r==="ai-analysis"&&e.jsx("div",{className:"space-y-6",children:c?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"w-12 h-12 text-[#2E7B91] mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-lg font-medium text-[#1E4F74] mb-2",children:"Analyzing compatibility..."}),e.jsx("p",{className:"text-sm text-[#475569]",children:"Our AI is finding what makes you a great match!"})]}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-[#2E7B9115] rounded-2xl",children:[e.jsx(O,{className:"w-6 h-6 text-[#2E7B91]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-[#1E4F74]",children:"AI Analysis Complete"}),e.jsx("p",{className:"text-sm text-[#25658A]",children:"Here's what I found..."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-2 font-medium",children:"Compatibility Score"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 bg-[#EAEAEA] rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-[#2E7B91] to-[#B69CFF] h-full rounded-full transition-all duration-1000",style:{width:`${x.score}%`}})}),e.jsxs(K,{className:"bg-[#2E7B9120] text-[#1E4F74]",children:[x.compatibility," Match (",x.score,"%)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-3 font-medium",children:"Key Highlights"}),e.jsx("div",{className:"space-y-2",children:x.similarities.map((T,p)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-[#F9F6F3] rounded-2xl",children:[e.jsx("div",{className:"w-2 h-2 bg-[#2E7B91] rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-[#1E4F74] leading-relaxed",children:T})]},p))})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-[#2E7B9115] to-[#B69CFF15] rounded-2xl border border-[#2E7B9140]",children:[e.jsxs("h3",{className:"text-sm text-[#1E4F74] mb-2 flex items-center gap-2 font-medium",children:[e.jsx(O,{className:"w-4 h-4 text-[#2E7B91]"}),"Why You Should Connect"]}),e.jsx("p",{className:"text-sm text-[#1E4F74] leading-relaxed",children:x.recommendation})]}),e.jsxs("div",{className:"flex gap-3 pt-6 pb-4",children:[e.jsx(y,{variant:"outline",onClick:t,className:"flex-1",children:"Maybe Later"}),e.jsxs(y,{onClick:U,disabled:k,className:"flex-1 gap-2 bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white rounded-2xl",children:[e.jsx(fe,{className:"w-4 h-4"}),k?"Sending...":"Send Intro"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-[#475569] mb-4",children:"Failed to generate analysis. Please try again."}),e.jsx(y,{onClick:()=>L(i),variant:"outline",children:"Retry"})]})}),r==="success"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(fe,{className:"w-10 h-10 text-green-600"})}),e.jsx("h3",{className:"text-xl mb-2",children:"Intro Sent! ðŸŽ‰"}),e.jsxs("p",{className:"text-[#475569] mb-4",children:[s.name.split(" ")[0]," will receive a notification about your interest in connecting."]}),e.jsx("p",{className:"text-sm text-[#64748b]",children:"They'll be able to review your profile and decide if they'd like to connect back."})]})]})})]})})}const he={colors:{love:{gradient:"from-[#FFB3C6] to-[#B69CFF]"}},components:{navigation:{header:"bg-white border-b border-[#EAEAEA]"}},layout:{maxWidth:"max-w-2xl"},transition:{default:"transition-all duration-200"}};function Yt(s){return`${window.location.origin}/profile/${s}`}function Wt(s,t){const a=Yt(s),l=`Check out ${t}'s profile on Bonded!`;navigator.share?navigator.share({title:`${t} on Bonded`,text:l,url:a}).catch(()=>{navigator.clipboard.writeText(a)}):navigator.clipboard.writeText(a)}function fs({...s}){return e.jsx(Cs,{"data-slot":"dialog",...s})}function Jt({...s}){return e.jsx(Fs,{"data-slot":"dialog-portal",...s})}const js=d.forwardRef(({className:s,...t},a)=>e.jsx(rs,{ref:a,"data-slot":"dialog-overlay",className:J("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t}));js.displayName=rs.displayName;function bs({className:s,children:t,...a}){return e.jsxs(Jt,{"data-slot":"dialog-portal",children:[e.jsx(js,{}),e.jsxs(As,{"data-slot":"dialog-content",className:J("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...a,children:[t,e.jsxs(Es,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(be,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function vs({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:J("flex flex-col gap-2 text-center sm:text-left",s),...t})}function ys({className:s,...t}){return e.jsx(Is,{"data-slot":"dialog-title",className:J("text-lg leading-none font-semibold",s),...t})}function Ns({className:s,...t}){return e.jsx(Bs,{"data-slot":"dialog-description",className:J("text-muted-foreground text-sm",s),...t})}function Kt({className:s,...t}){return e.jsx(Ls,{"data-slot":"radio-group",className:J("grid gap-3",s),...t})}function Le({className:s,...t}){return e.jsx($s,{"data-slot":"radio-group-item",className:J("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Ms,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(tt,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}const Qt={maxRetries:3,initialDelay:1e3,maxDelay:1e4,retryableStatuses:[408,429,500,502,503,504]};async function Zt(s,t={},a={}){const l={...Qt,...a};let r=null;for(let h=0;h<=l.maxRetries;h++)try{const i=await fetch(s,t);if(i.ok||!l.retryableStatuses.includes(i.status)||h===l.maxRetries)return i;const o=Math.min(l.initialDelay*Math.pow(2,h),l.maxDelay);await new Promise(x=>setTimeout(x,o))}catch(i){if(r=i,h===l.maxRetries)throw i;const o=Math.min(l.initialDelay*Math.pow(2,h),l.maxDelay);await new Promise(x=>setTimeout(x,o))}throw r||new Error("Request failed after retries")}const ns=new Map;function Xt(s,t=10,a=6e4){const l=Date.now(),r=ns.get(s);return!r||l>r.resetTime?(ns.set(s,{count:1,resetTime:l+a}),!0):r.count>=t?!1:(r.count++,!0)}function me(s){if(typeof s!="string")return"";let t=s.replace(/\0/g,"");return t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),t=t.replace(/on\w+\s*=\s*["'][^"']*["']/gi,""),t=t.replace(/javascript:/gi,""),t=t.replace(/data:(?!image\/|text\/plain)/gi,""),t=t.trim(),t}function ea(s){if(!s||typeof s!="object")return{};const t={};return s.name&&(t.name=me(s.name)),s.bio&&(t.bio=me(s.bio)),s.school&&(t.school=me(s.school)),s.major&&(t.major=me(s.major)),s.year&&(t.year=me(s.year)),Array.isArray(s.interests)&&(t.interests=s.interests.filter(a=>typeof a=="string").map(a=>me(a))),Array.isArray(s.lookingFor)&&(t.lookingFor=s.lookingFor.filter(a=>typeof a=="string").map(a=>me(a))),Object.keys(s).forEach(a=>{["name","bio","school","major","year","interests","lookingFor"].includes(a)||(t[a]=s[a])}),t}class pe extends Error{status;code;constructor(t,a,l){super(t),this.name="ApiClientError",this.status=a,this.code=l}}async function ws(s,t={},a){if(!Pt())throw new pe("No internet connection",0,"OFFLINE");const l=`api:${s.split("?")[0]}`;if(!Xt(l,30,6e4))throw new pe("Rate limit exceeded. Please try again later.",429,"RATE_LIMIT");const r=`${gs}/functions/v1/make-server-2516be19${s}`;try{const h=await Zt(r,t,a);if(!h.ok){let i=`Request failed: ${h.status}`;try{const o=await h.json();i=o.error||o.message||i}catch{i=h.statusText||i}throw new pe(i,h.status)}return h}catch(h){throw h instanceof pe?h:h instanceof TypeError&&h.message.includes("fetch")?new pe("Network error. Please check your connection.",0,"NETWORK_ERROR"):new pe(h instanceof Error?h.message:"An unexpected error occurred",0,"UNKNOWN_ERROR")}}async function sa(s,t,a){const l={"Content-Type":"application/json"};return t&&(l.Authorization=`Bearer ${t}`),(await ws(s,{method:"GET",headers:l},a)).json()}async function is(s,t,a,l){const r=s.includes("/profile")&&t?ea(t):t,h={"Content-Type":"application/json"};return a&&(h.Authorization=`Bearer ${a}`),(await ws(s,{method:"POST",headers:h,body:r?JSON.stringify(r):void 0},l)).json()}function ta({userId:s,userName:t,accessToken:a,open:l,onClose:r,onBlock:h}){const[i,o]=d.useState(null),[x,u]=d.useState(""),[k,E]=d.useState(""),[c,j]=d.useState(!1),I=async()=>{if(!x){C.error("Please select a reason");return}j(!0);try{await is(`/user/${s}/report`,{reason:x,details:k},a),C.success("Report submitted. We will review it shortly."),r(),o(null),u(""),E("")}catch($){C.error($.message||"Failed to submit report")}finally{j(!1)}},L=async()=>{j(!0);try{await is(`/user/${s}/block`,{},a),C.success(`${t} has been blocked`),h?.(),r(),o(null)}catch($){C.error($.message||"Failed to block user")}finally{j(!1)}};return e.jsx(fs,{open:l,onOpenChange:r,children:e.jsxs(bs,{className:"max-w-md",children:[e.jsxs(vs,{children:[e.jsxs(ys,{children:["Report or Block ",t]}),e.jsx(Ns,{children:"Help us keep Bonded safe and respectful"})]}),i?i==="report"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(H,{children:"Reason for reporting"}),e.jsxs(Kt,{value:x,onValueChange:u,className:"mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{value:"inappropriate",id:"inappropriate"}),e.jsx(H,{htmlFor:"inappropriate",className:"font-normal",children:"Inappropriate content"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{value:"harassment",id:"harassment"}),e.jsx(H,{htmlFor:"harassment",className:"font-normal",children:"Harassment or bullying"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{value:"spam",id:"spam"}),e.jsx(H,{htmlFor:"spam",className:"font-normal",children:"Spam or fake profile"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{value:"other",id:"other"}),e.jsx(H,{htmlFor:"other",className:"font-normal",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"details",children:"Additional details (optional)"}),e.jsx(Oe,{id:"details",value:k,onChange:$=>E($.target.value),placeholder:"Tell us more about what happened...",className:"mt-2",rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>{o(null),u(""),E("")},className:"flex-1",children:"Back"}),e.jsx(y,{onClick:I,disabled:c||!x,className:"flex-1 bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white",children:"Submit Report"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-[#2E7B9115] rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-[#2E7B91] flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[#1E4F74] font-medium mb-1",children:"What happens when you block someone?"}),e.jsxs("ul",{className:"text-xs text-[#475569] space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"They won't be able to message you"}),e.jsx("li",{children:"They won't appear in your Discover feed"}),e.jsx("li",{children:"You won't appear in their Discover feed"}),e.jsx("li",{children:"You can unblock them anytime in settings"})]})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>o(null),className:"flex-1",children:"Cancel"}),e.jsxs(y,{onClick:L,disabled:c,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:["Block ",t]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs(y,{onClick:()=>o("report"),variant:"outline",className:"w-full justify-start",children:[e.jsx(at,{className:"w-4 h-4 mr-2"}),"Report User"]}),e.jsxs(y,{onClick:()=>o("block"),variant:"outline",className:"w-full justify-start",children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Block User"]})]})]})})}function qe({profile:s,onClose:t,onNext:a,onPrev:l,hasNext:r,hasPrev:h,accessToken:i}){const[o,x]=d.useState(!1),[u,k]=d.useState(!1),[E,c]=d.useState(!1);d.useEffect(()=>{setTimeout(()=>{const A=document.querySelector("[data-action-buttons]");if(A){console.log("âœ… Action buttons element found in DOM");const D=window.getComputedStyle(A);console.log("Button position:",D.position),console.log("Button bottom:",D.bottom),console.log("Button zIndex:",D.zIndex),console.log("Button display:",D.display),console.log("Button visibility:",D.visibility)}else console.error("âŒ Action buttons element NOT found in DOM!")},100)},[]);const[j,I]=d.useState(null),[L,$]=d.useState(null),[U,T]=d.useState(0),[p,f]=d.useState(null),[B,b]=d.useState(!1);d.useEffect(()=>{k(!1),F()},[s.id]);const F=async()=>{if(i){b(!0);try{const A=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/compatibility/${s.id}`,{headers:{Authorization:`Bearer ${i}`}});if(A.ok){const D=await A.json();f(D)}}catch(A){console.error("Error loading compatibility:",A)}finally{b(!1)}}},n=50,g=A=>{$(null),I(A.targetTouches[0].clientX)},w=A=>{$(A.targetTouches[0].clientX)},M=()=>{if(!j||!L)return;const A=j-L,D=A>n,v=A<-n;D&&r&&(T(1),a()),v&&h&&(T(-1),l())},q=()=>{const A=!u;k(A),A&&C.success(`You liked ${s.name}!`,{description:"They'll be notified of your interest."})};return e.jsxs("div",{className:"fixed inset-0 bg-white z-[9999] flex flex-col",style:{height:"100dvh",maxHeight:"100dvh",display:"flex",flexDirection:"column",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,WebkitTransform:"translateZ(0)",transform:"translateZ(0)",overflow:"hidden"},children:[e.jsxs("div",{className:`${he.components.navigation.header} px-4 py-4 flex items-center justify-between flex-shrink-0`,children:[e.jsx("button",{onClick:t,className:`p-2 -ml-2 hover:bg-gray-100 rounded-full ${he.transition.default}`,children:e.jsx(be,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[s.name,", ",s.age]}),e.jsx("p",{className:"text-sm text-[#64748b]",children:s.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{Wt(s.id,s.name),C.success("Profile link copied!")},className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Share profile",children:e.jsx(nt,{className:"w-5 h-5 text-[#2E7B91]"})}),i&&e.jsx("button",{onClick:()=>c(!0),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"More options",children:e.jsx(it,{className:"w-5 h-5 text-[#2E7B91]"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden min-h-0",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",paddingBottom:"calc(100px + env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"relative w-full aspect-[3/4] bg-gray-100 overflow-hidden",onTouchStart:g,onTouchMove:w,onTouchEnd:M,children:[e.jsx(Y.img,{initial:{opacity:0,x:U*50},animate:{opacity:1,x:0},exit:{opacity:0,x:-U*50},transition:{duration:.3},src:s.profilePicture||s.photos?.[0]||s.imageUrl||"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=800&q=80",alt:s.name,className:"w-full h-full object-cover"},s.id),h&&e.jsx("button",{onClick:l,className:"absolute left-0 top-0 bottom-0 w-1/3 flex items-center justify-start pl-4 group",children:e.jsx("div",{className:"w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 group-active:opacity-100 transition-opacity",children:e.jsx(rt,{className:"w-6 h-6"})})}),r&&e.jsx("button",{onClick:a,className:"absolute right-0 top-0 bottom-0 w-1/3 flex items-center justify-end pr-4 group",children:e.jsx("div",{className:"w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 group-active:opacity-100 transition-opacity",children:e.jsx(lt,{className:"w-6 h-6"})})}),e.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-black/50 px-3 py-1 rounded-full",children:e.jsx("p",{className:"text-white text-xs",children:"Swipe to see more profiles"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl mb-1",children:[s.name,", ",s.age]}),e.jsxs("p",{className:"text-[#475569]",children:[s.major," â€¢ ",s.year]}),e.jsx("p",{className:"text-sm text-[#64748b]",children:s.school})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-2 font-medium",children:"About"}),e.jsx("p",{className:"text-[#1E4F74]",children:s.bio})]}),p&&e.jsxs("div",{className:"bg-gradient-to-br from-[#2E7B9115] to-[#25658A15] rounded-2xl p-4 border border-[#2E7B9140]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(O,{className:"w-5 h-5 text-[#2E7B91]"}),e.jsx("h3",{className:"font-medium text-[#1E4F74]",children:"Compatibility"})]}),e.jsxs("div",{className:"space-y-3",children:[p.score&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-medium text-[#25658A]",children:[p.score,"% Match"]})}),p.commonInterests&&p.commonInterests.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#64748b] mb-1",children:"You both enjoy:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:p.commonInterests.map(A=>e.jsx(K,{className:"text-xs bg-[#2E7B9120] text-[#1E4F74]",children:A},A))})]}),p.analysis&&e.jsx("p",{className:"text-sm text-[#1E4F74]",children:p.analysis})]})]}),s.lookingFor&&s.lookingFor.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-2 font-medium",children:"Looking For"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.lookingFor.map(A=>{const D=A.split("-").map(v=>v.charAt(0).toUpperCase()+v.slice(1)).join(" ");return e.jsx(K,{className:"bg-[#2E7B9120] text-[#1E4F74] whitespace-nowrap",children:D},A)})})]}),s.interests&&s.interests.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-2 font-medium",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.interests.map(A=>e.jsx(K,{variant:"outline",children:A},A))})]}),s.personality&&s.personality.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-2 font-medium",children:"Personality"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.personality.map(A=>e.jsx(K,{variant:"secondary",children:A},A))})]}),(s.sleepSchedule||s.cleanliness)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-2 font-medium",children:"Living Habits"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[s.sleepSchedule&&e.jsxs("p",{children:[e.jsx("span",{className:"text-[#64748b]",children:"Sleep Schedule:"})," ",e.jsx("span",{className:"capitalize",children:s.sleepSchedule})]}),s.cleanliness&&e.jsxs("p",{children:[e.jsx("span",{className:"text-[#64748b]",children:"Cleanliness:"})," ",e.jsx("span",{className:"capitalize",children:s.cleanliness})]})]})]}),(s.instagram||s.snapchat)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-[#64748b] mb-2 font-medium",children:"Social Media"}),e.jsxs("div",{className:"space-y-2",children:[s.instagram&&e.jsxs("a",{href:`https://instagram.com/${s.instagram.replace("@","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-[#2E7B91] hover:text-[#25658A] hover:underline",children:[e.jsx(os,{className:"w-4 h-4"}),s.instagram]}),s.snapchat&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-[#64748b]",children:"Snapchat:"})," ",s.snapchat]})]})]})]})]}),typeof document<"u"&&Rs.createPortal(e.jsx("div",{"data-action-buttons":!0,className:"bg-white border-t-2 border-[#EAEAEA] px-4 py-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]",style:{position:"fixed",bottom:0,left:0,right:0,paddingTop:"1rem",paddingBottom:"max(1rem, env(safe-area-inset-bottom))",minHeight:"80px",width:"100vw",maxWidth:"100%",backgroundColor:"#ffffff",zIndex:99999,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1), 0 -2px 4px -1px rgba(0, 0, 0, 0.06)",WebkitTransform:"translateZ(0)",transform:"translateZ(0)",willChange:"transform",display:"block",visibility:"visible",opacity:1,WebkitBackfaceVisibility:"visible",backfaceVisibility:"visible"},children:e.jsxs("div",{className:"flex gap-3 max-w-2xl mx-auto",children:[e.jsxs(y,{variant:"outline",size:"lg",onClick:q,className:`flex-1 gap-2 font-semibold h-12 text-base rounded-2xl ${u?"bg-red-50 border-2 border-red-400 text-red-600 hover:bg-red-100":"border-2 hover:border-gray-400"}`,children:[e.jsx(te,{className:`w-5 h-5 ${u?"fill-red-600":""}`}),u?"Liked":"Like"]}),e.jsxs("button",{"data-soft-intro-button":!0,onClick:()=>{if(!i){C.error("Please log in to send a soft intro");return}x(!0)},"aria-label":`Send soft intro to ${s.name}`,className:"flex-1 gap-2 font-semibold h-12 shadow-lg text-base rounded-2xl flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#2E7B91]",style:{color:"#ffffff",backgroundColor:"#2E7B91",background:"linear-gradient(to right, #2E7B91, #25658A)",backgroundImage:"linear-gradient(to right, #2E7B91, #25658A)",border:"none"},children:[e.jsx(O,{className:"w-5 h-5",style:{color:"#ffffff",fill:"none",stroke:"#ffffff"},"aria-hidden":"true"}),e.jsx("span",{style:{color:"#ffffff",fontWeight:600},children:"Soft Intro"})]})]})}),document.body),o&&e.jsx(Ht,{profile:s,onClose:()=>x(!1),accessToken:i}),i&&e.jsx(ta,{userId:s.id,userName:s.name,accessToken:i,open:E,onClose:()=>c(!1),onBlock:()=>{C.success("User blocked. They will no longer appear in your feed."),t()}})]})}function re({className:s,...t}){return e.jsx("div",{"data-slot":"skeleton",className:J("bg-accent animate-pulse rounded-md",s),...t})}function aa(){return e.jsx("div",{className:"grid grid-cols-2 gap-3 p-3",children:[...Array(6)].map((s,t)=>e.jsx(S,{className:"overflow-hidden",children:e.jsx("div",{className:"aspect-[3/4]",children:e.jsx(re,{className:"w-full h-full"})})},t))})}function na(){return e.jsx("div",{className:"divide-y",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"p-4 flex items-center gap-3",children:[e.jsx(re,{className:"w-14 h-14 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(re,{className:"h-4 w-32"}),e.jsx(re,{className:"h-3 w-48"})]})]},t))})}function ia(){return e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,t)=>e.jsx(S,{children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(re,{className:"w-16 h-16 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(re,{className:"h-4 w-32"}),e.jsx(re,{className:"h-3 w-48"}),e.jsx(re,{className:"h-20 w-full rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(re,{className:"h-9 flex-1"}),e.jsx(re,{className:"h-9 flex-1"})]})]})]})})},t))})}function ra(s,t){let a=null;return function(...r){const h=()=>{a=null,s(...r)};a&&clearTimeout(a),a=setTimeout(h,t)}}function ye({...s}){return e.jsx(zs,{"data-slot":"select",...s})}function Ne({...s}){return e.jsx(_s,{"data-slot":"select-value",...s})}function we({className:s,size:t="default",children:a,...l}){return e.jsxs(Ts,{"data-slot":"select-trigger","data-size":t,className:J("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l,children:[a,e.jsx(Ds,{asChild:!0,children:e.jsx(cs,{className:"size-4 opacity-50"})})]})}function ke({className:s,children:t,position:a="popper",...l}){return e.jsx(Ps,{children:e.jsxs(Os,{"data-slot":"select-content",className:J("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...l,children:[e.jsx(la,{}),e.jsx(Us,{className:J("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(oa,{})]})})}function ie({className:s,children:t,...a}){return e.jsxs(Gs,{"data-slot":"select-item",className:J("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(qs,{children:e.jsx(Re,{className:"size-4"})})}),e.jsx(Vs,{children:t})]})}function la({className:s,...t}){return e.jsx(Hs,{"data-slot":"select-scroll-up-button",className:J("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ot,{className:"size-4"})})}function oa({className:s,...t}){return e.jsx(Ys,{"data-slot":"select-scroll-down-button",className:J("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(cs,{className:"size-4"})})}function ca({searchQuery:s,onSearchChange:t,filters:a,onFiltersChange:l,availableMajors:r=[],availableYears:h=["Freshman","Sophomore","Junior","Senior","Graduate"],availableLookingFor:i=["Study Partner","Roommate","Friend","Activity Partner","Co-founder"],availableAcademicGoals:o=[],availableLeisureGoals:x=[]}){const[u,k]=d.useState(!1),[E,c]=d.useState(!1),[j,I]=d.useState(s),L=d.useCallback(ra(p=>{t(p)},300),[t]);d.useEffect(()=>{I(s)},[s]);const $=p=>{I(p),L(p)},U=Object.values(a).filter(p=>p&&p!=="all"&&p!=="All").length,T=()=>{l({major:"all",year:"all",lookingFor:"all",academicGoal:"all",leisureGoal:"all",sortBy:"newest"})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#64748b]"}),e.jsx(X,{type:"text",placeholder:"Search by name, major, interests...",value:j,onChange:p=>$(p.target.value),className:"pl-10 pr-10","aria-label":"Search profiles"}),j&&e.jsx("button",{onClick:()=>{I(""),t("")},className:"absolute right-3 top-1/2 -translate-y-1/2 text-[#64748b] hover:text-[#1E4F74]","aria-label":"Clear search",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>k(!u),className:"flex-1 justify-start",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Filters",U>0&&e.jsx(K,{className:"ml-2 bg-[#2E7B91] text-white",children:U})]}),e.jsxs(ye,{value:a.sortBy||"newest",onValueChange:p=>{l({...a,sortBy:p})},children:[e.jsx(we,{className:"w-[140px]",children:e.jsx(Ne,{})}),e.jsxs(ke,{children:[e.jsx(ie,{value:"newest",children:"Newest"}),e.jsx(ie,{value:"compatibility",children:"Compatibility"}),e.jsx(ie,{value:"name",children:"Name"})]})]}),e.jsx(y,{variant:"outline",size:"icon",onClick:()=>c(!E),"aria-label":E?"Sort descending":"Sort ascending",children:E?e.jsx(dt,{className:"w-4 h-4"}):e.jsx(mt,{className:"w-4 h-4"})})]}),u&&e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-[#1E4F74]",children:"Filter Profiles"}),U>0&&e.jsx(y,{variant:"ghost",size:"sm",onClick:T,className:"text-xs text-[#64748b]",children:"Clear all"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[#64748b] mb-1 block",children:"Major"}),e.jsxs(ye,{value:a.major||"all",onValueChange:p=>l({...a,major:p}),children:[e.jsx(we,{children:e.jsx(Ne,{})}),e.jsxs(ke,{children:[e.jsx(ie,{value:"all",children:"All Majors"}),r.map(p=>e.jsx(ie,{value:p,children:p},p))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[#64748b] mb-1 block",children:"Year"}),e.jsxs(ye,{value:a.year||"all",onValueChange:p=>l({...a,year:p}),children:[e.jsx(we,{children:e.jsx(Ne,{})}),e.jsxs(ke,{children:[e.jsx(ie,{value:"all",children:"All Years"}),h.map(p=>e.jsx(ie,{value:p,children:p},p))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[#64748b] mb-1 block",children:"Looking For"}),e.jsxs(ye,{value:a.lookingFor||"all",onValueChange:p=>l({...a,lookingFor:p}),children:[e.jsx(we,{children:e.jsx(Ne,{})}),e.jsxs(ke,{children:[e.jsx(ie,{value:"all",children:"All"}),i.map(p=>e.jsx(ie,{value:p.toLowerCase().replace(/\s+/g,"-"),children:p},p))]})]})]}),o.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[#64748b] mb-1 block",children:"Academic Goal"}),e.jsxs(ye,{value:a.academicGoal||"all",onValueChange:p=>l({...a,academicGoal:p}),children:[e.jsx(we,{children:e.jsx(Ne,{})}),e.jsxs(ke,{children:[e.jsx(ie,{value:"all",children:"All Goals"}),o.map(p=>e.jsx(ie,{value:p.toLowerCase().replace(/\s+/g,"-"),children:p},p))]})]})]})]})]})})]})}function da({userProfile:s,accessToken:t,onProfileDetailOpen:a}){const[l,r]=d.useState(null),[h,i]=d.useState(""),[o,x]=d.useState({major:"all",year:"all",lookingFor:"all",academicGoal:"all",leisureGoal:"all",sortBy:"newest"}),[u,k]=d.useState([]),[E,c]=d.useState(!0),[j,I]=d.useState({});d.useEffect(()=>{L()},[s]);const L=async()=>{if(!s||!t){c(!1);return}try{const g=await sa(`/profiles?school=${encodeURIComponent(s.school)}`,t,{maxRetries:2}),w=s.blockedUsers||[],M=g.filter(q=>q.id!==s.id&&!w.includes(q.id)).map(q=>({...q,imageUrl:q.profilePicture||q.photos?.[0]||"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=800&q=80",age:q.age||20}));k(M),s.bondPrint&&$(M)}catch(g){const w=g?.message||"Failed to load profiles";C.error(w)}finally{c(!1)}},$=async g=>{if(!s?.bondPrint||!t)return;const w={},{BOND_PRINT_LIMITS:M}=await Dt(async()=>{const{BOND_PRINT_LIMITS:A}=await Promise.resolve().then(()=>qt);return{BOND_PRINT_LIMITS:A}},void 0),q=g.slice(0,M.MAX_PARALLEL_CHECKS);await Promise.all(q.map(async A=>{try{const D=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/bond-print/compatibility/${A.id}`,{headers:{Authorization:`Bearer ${t}`}});if(D.ok){const v=await D.json();v.score!==void 0&&v.score>0&&(w[A.id]=v.score)}else D.status}catch{}})),I(w)},U=d.useMemo(()=>{const g=new Set;return u.forEach(w=>{w.major&&g.add(w.major)}),Array.from(g).sort()},[u]),T=d.useMemo(()=>{const g=new Set;return u.forEach(w=>{w.goals?.academic?.forEach(M=>g.add(M))}),Array.from(g).sort()},[u]),p=d.useMemo(()=>{const g=new Set;return u.forEach(w=>{w.goals?.leisure?.forEach(M=>g.add(M))}),Array.from(g).sort()},[u]),f=d.useMemo(()=>{let g=u.filter(w=>{const M=h===""||w.name.toLowerCase().includes(h.toLowerCase())||w.major?.toLowerCase().includes(h.toLowerCase())||w.interests?.some(ce=>ce.toLowerCase().includes(h.toLowerCase()))||w.bio?.toLowerCase().includes(h.toLowerCase()),q=o.major==="all"||w.major===o.major,A=o.year==="all"||w.year===o.year,D=o.lookingFor.toLowerCase().replace(/\s+/g,"-"),v=o.lookingFor==="all"||w.lookingFor?.includes(D),R=o.academicGoal.toLowerCase().replace(/\s+/g,"-"),V=o.academicGoal==="all"||w.goals?.academic?.some(ce=>ce.toLowerCase().includes(R)),ae=o.leisureGoal.toLowerCase().replace(/\s+/g,"-"),ve=o.leisureGoal==="all"||w.goals?.leisure?.some(ce=>ce.toLowerCase().includes(ae));return M&&q&&A&&v&&V&&ve});return g=[...g].sort((w,M)=>{if(o.sortBy==="compatibility"){const q=j[w.id]||0,A=j[M.id]||0;if(A!==q)return A-q}else if(o.sortBy==="name")return w.name.localeCompare(M.name);return 0}),g},[u,h,o,j]),B=g=>{const w=f[g],M=u.findIndex(q=>q.id===w.id);r(M),a?.(!0)},b=()=>{r(null),a?.(!1)},F=()=>{l!==null&&l<u.length-1&&r(l+1)},n=()=>{l!==null&&l>0&&r(l-1)};return l!==null?e.jsx(qe,{profile:u[l],onClose:b,onNext:F,onPrev:n,hasNext:l<u.length-1,hasPrev:l>0,accessToken:t}):E?e.jsxs("div",{className:"min-h-screen bg-[#F9F6F3]",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-[#EAEAEA] px-4 py-3 z-10",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("img",{src:"/Bonded_transparent_icon.png",alt:"bonded logo",className:"w-8 h-8"}),e.jsx("h1",{className:"text-2xl text-[#1E4F74] lowercase font-bold tracking-wide",children:"bonded"})]})}),e.jsx(aa,{})]}):e.jsxs("div",{className:"min-h-screen bg-[#F9F6F3]",children:[e.jsx("div",{className:"sticky top-[60px] bg-white border-b border-[#EAEAEA] px-4 py-3 z-10",children:e.jsx(ca,{searchQuery:h,onSearchChange:i,filters:o,onFiltersChange:x,availableMajors:U,availableAcademicGoals:T,availableLeisureGoals:p})}),e.jsxs("div",{className:"bg-white border-b px-4 py-3 flex justify-around text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[#2E7B91]",children:f.length}),e.jsx("p",{className:"text-xs text-[#475569]",children:"Students"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s?.school||"Your School"}),e.jsx("p",{className:"text-xs text-[#475569]",children:"University"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-600",children:"Active"}),e.jsx("p",{className:"text-xs text-[#475569]",children:"Community"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 p-3",children:f.map((g,w)=>{const M=j[g.id],q=M&&M>=70,A=M&&M>=50&&M<70;return e.jsxs("button",{onClick:()=>B(w),onKeyDown:D=>handleGridKeyDown(D,()=>B(w),w<f.length-1?()=>B(w+1):void 0,w>0?()=>B(w-1):void 0),"aria-label":getProfileCardAriaLabel(g),className:`relative overflow-hidden bg-white rounded-2xl shadow-sm hover:shadow-md active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-[#2E7B91] focus:ring-offset-2 ${q?"ring-2 ring-[#2E7B91] ring-offset-2":A?"ring-1 ring-[#25658A]":""}`,children:[M&&M>=50&&e.jsxs("div",{className:`absolute top-2 right-2 z-10 ${q?"bg-gradient-to-r from-[#2E7B91] to-[#B69CFF]":"bg-[#25658A]"} text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-lg flex items-center gap-1`,children:[e.jsx(O,{className:"w-3 h-3"}),M,"% Match"]}),e.jsxs("div",{className:"aspect-[3/4] relative",children:[e.jsx("img",{src:g.imageUrl,alt:g.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-3 text-white text-left",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:g.name}),e.jsx("p",{className:"text-xs text-gray-200 truncate",children:g.major}),e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:g.lookingFor?.slice(0,2).map((D,v)=>{const R=D.split("-").map(V=>V.charAt(0).toUpperCase()+V.slice(1)).join(" ");return e.jsx("span",{className:"text-[10px] bg-white/20 backdrop-blur-sm px-2 py-0.5 rounded-full whitespace-nowrap",children:R},v)})})]})]})]},g.id)})})]})}function ne({className:s,...t}){return e.jsx(Ws,{"data-slot":"avatar",className:J("relative flex size-10 shrink-0 overflow-hidden rounded-full",s),...t})}function ee({className:s,...t}){return e.jsx(Js,{"data-slot":"avatar-image",className:J("aspect-square size-full",s),...t})}function se({className:s,...t}){return e.jsx(Ks,{"data-slot":"avatar-fallback",className:J("bg-muted flex size-full items-center justify-center rounded-full",s),...t})}const ma={log:(...s)=>{Fe(s.join(" "),"log","info")},error:(...s)=>{const t=s.map(a=>typeof a=="object"?JSON.stringify(a):String(a)).join(" ");s[0]instanceof Error?_t(s[0],{extra:{additionalInfo:s.slice(1)}}):ss(t,"error"),Fe(t,"error","error")},warn:(...s)=>{const t=s.join(" ");ss(t,"warning"),Fe(t,"warning","warning")},info:(...s)=>{Fe(s.join(" "),"info","info")}};function Me({type:s,title:t,description:a,actionLabel:l,onAction:r}){const i={"no-connections":{icon:je,defaultTitle:"No connections yet",defaultDescription:"Start exploring to find people you'd like to connect with!",defaultAction:"Discover People",color:"text-[#2E7B91]",bgColor:"bg-[#2E7B9115]"},"no-messages":{icon:Ue,defaultTitle:"No messages yet",defaultDescription:"Start a conversation with someone you've connected with!",defaultAction:"View Connections",color:"text-[#2E7B91]",bgColor:"bg-[#2E7B9115]"},"no-profiles":{icon:ds,defaultTitle:"No profiles found",defaultDescription:"Try adjusting your filters or search terms.",defaultAction:"Clear Filters",color:"text-[#64748b]",bgColor:"bg-[#EAEAEA]"},"no-matches":{icon:ls,defaultTitle:"No matches found",defaultDescription:"Keep exploring! New people join every day.",defaultAction:"Keep Exploring",color:"text-[#64748b]",bgColor:"bg-[#EAEAEA]"},"no-chats":{icon:ht,defaultTitle:"No chats yet",defaultDescription:"Your conversations will appear here once you start messaging.",defaultAction:"Find People",color:"text-[#2E7B91]",bgColor:"bg-[#2E7B9115]"}}[s],o=i.icon;return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[e.jsx("div",{className:`w-16 h-16 ${i.bgColor} rounded-full flex items-center justify-center mb-4`,children:e.jsx(o,{className:`w-8 h-8 ${i.color}`})}),e.jsx("h3",{className:"text-lg font-semibold text-[#1E4F74] mb-2",children:t||i.defaultTitle}),e.jsx("p",{className:"text-sm text-[#475569] mb-6 max-w-sm",children:a||i.defaultDescription}),r&&e.jsx(y,{onClick:r,className:"bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white",children:l||i.defaultAction})]})}const ha={LOVE_MODE_ENABLED:!0,AI_ASSISTANT_ENABLED:!0};function Ce(s){return ha[s]===!0}function xa({userProfile:s,accessToken:t}){const[a,l]=d.useState([]),[r,h]=d.useState(null),[i,o]=d.useState([]),[x,u]=d.useState(""),[k,E]=d.useState(!0),[c,j]=d.useState(!1),[I,L]=d.useState(!1),[$,U]=d.useState(null),[T,p]=d.useState(!0),[f,B]=d.useState(!1),[b,F]=d.useState([]),[n,g]=d.useState([]),[w,M]=d.useState([]),[q,A]=d.useState(null),[D,v]=d.useState(!1),[R,V]=d.useState(null);d.useEffect(()=>{ae();const m=setInterval(ae,Ae.MESSAGES);return()=>clearInterval(m)},[]),d.useEffect(()=>{f&&Ce("AI_ASSISTANT_ENABLED")?Ye():f&&!Ce("AI_ASSISTANT_ENABLED")&&B(!1)},[f]),d.useEffect(()=>{if(r){L(!1),ve(),Ve(),ce();const m=setInterval(ve,Ae.MESSAGES),N=setInterval(Ve,Ae.TYPING_STATUS);return()=>{clearInterval(m),clearInterval(N),L(!1)}}else L(!1)},[r]),d.useEffect(()=>{s?.settings?.readReceipts!==void 0&&p(s.settings.readReceipts)},[s]);const ae=async()=>{try{const m=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chats`,{headers:{Authorization:`Bearer ${t}`}});if(!m.ok)throw new Error("Failed to load chats");const N=await m.json();l(Array.isArray(N)?N:[])}catch(m){console.error("Load chats error:",m),C.error("Failed to load chats"),l([])}finally{E(!1)}},ve=async()=>{if(r?.chatId)try{const m=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chat/${r.chatId}/messages`,{headers:{Authorization:`Bearer ${t}`}});if(!m.ok)throw new Error("Failed to load messages");const N=await m.json();o(Array.isArray(N)?N:[])}catch(m){console.error("Load messages error:",m),C.error("Failed to load messages"),o([])}},ce=async()=>{if(r?.chatId)try{await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chat/${r.chatId}/read`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),window.__refreshNavCounts&&window.__refreshNavCounts(),await ae()}catch{}},Ve=async()=>{if(!r?.chatId){L(!1);return}try{const m=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chat/${r.chatId}/typing`,{headers:{Authorization:`Bearer ${t}`}});if(m.ok){const N=await m.json();L(N.typing===!0)}else L(!1)}catch{L(!1)}},ks=()=>{if(!r?.chatId)return;fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chat/${r.chatId}/typing/start`,{method:"POST",headers:{Authorization:`Bearer ${t}`}}).catch(()=>{}),$&&clearTimeout($);const m=setTimeout(()=>{r?.chatId&&fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chat/${r.chatId}/typing/stop`,{method:"POST",headers:{Authorization:`Bearer ${t}`}}).catch(()=>{})},3e3);U(m)},He=async()=>{if(!(!x.trim()||c||!r?.chatId)){$&&(clearTimeout($),U(null)),r?.chatId&&fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chat/${r.chatId}/typing/stop`,{method:"POST",headers:{Authorization:`Bearer ${t}`}}).catch(()=>{}),j(!0);try{if(!(await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/chat/${r.chatId}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({content:x})})).ok)throw new Error("Failed to send message");u(""),await ve()}catch(m){console.error("Send message error:",m),C.error("Failed to send message")}finally{j(!1)}}},de=m=>m.split(" ").map(N=>N[0]).join("").toUpperCase().slice(0,2),ze=m=>{const N=new Date(m),_=(new Date().getTime()-N.getTime())/(1e3*60*60);return _<24?N.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):_<48?"Yesterday":N.toLocaleDateString("en-US",{month:"short",day:"numeric"})},Ye=async()=>{try{const m=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/ai-assistant/chat`,{headers:{Authorization:`Bearer ${t}`}});if(m.ok){const z=(await m.json()).messages||[];F(z);const _=[];z.forEach(P=>{P.metadata?.type==="profile-suggestions"&&P.metadata?.profiles&&P.metadata.profiles.forEach(Z=>{_.find(le=>le.id===Z.id)||_.push(Z)})}),_.length>0&&M(_)}}catch(m){console.error("Load AI chat error:",m)}},Be=async()=>{if(!(!x.trim()||D)){v(!0);try{const m=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/ai-assistant/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({message:x})});if(!m.ok)throw new Error("Failed to send message");const N=await m.json(),z={id:`ai-msg-${Date.now()}`,senderId:s.id,content:x,timestamp:new Date().toISOString(),type:"user"},_={id:`ai-msg-${Date.now()+1}`,senderId:"ai-assistant",content:N.response,timestamp:new Date().toISOString(),type:"ai"};F(P=>[...P,z,_]),u(""),g(N.suggestions||[]),N.shouldSearch&&await We(x),N.response&&(N.response.toLowerCase().includes("search")||N.response.toLowerCase().includes("let me find")||N.response.toLowerCase().includes("i'll search"))&&await We(x)}catch(m){console.error("Send AI message error:",m),C.error("Failed to send message")}finally{v(!1)}}},We=async m=>{try{console.log("[SEARCH] Searching for:",m);const N=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/ai-assistant/search`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({query:m})});if(!N.ok){const _=await N.text();throw console.error("[SEARCH] Search failed:",N.status,_),new Error(`Search failed: ${N.status}`)}const z=await N.json();if(console.log("[SEARCH] Search results:",z),M(_=>{const P=z.matches||[],Z=[..._];return P.forEach(le=>{Z.find(ue=>ue.id===le.id)||Z.push(le)}),Z}),await Ye(),z.matches&&z.matches.length===0){const _={id:`ai-msg-${Date.now()}`,senderId:"ai-assistant",content:"I couldn't find any matches for that right now. Try being more specific or check back later as more people join!",timestamp:new Date().toISOString(),type:"ai"};F(P=>[...P,_])}}catch(N){console.error("[SEARCH] Search profiles error:",N);const z={id:`ai-msg-${Date.now()}`,senderId:"ai-assistant",content:"I had trouble searching right now. Please try again in a moment!",timestamp:new Date().toISOString(),type:"ai"};F(_=>[..._,z])}},Ss=async(m,N)=>{try{const z=b.slice(-5).map(ue=>`${ue.senderId===s.id?"User":"Link"}: ${ue.content}`).join(`
`),_=x?`Current message: ${x}

Recent conversation:
${z}`:`Recent conversation:
${z}`,P=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/ai-assistant/soft-intro`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({targetUserId:m,reason:N,context:_})});if(!P.ok)throw new Error("Failed to request soft intro");const Z=await P.json();A({targetUserId:m,reason:N,introRequestId:Z.introRequestId});const le={id:`ai-msg-${Date.now()}`,senderId:"ai-assistant",content:"Great! I've sent a message to them explaining the situation. I'll let you know when they respond!",timestamp:new Date().toISOString(),type:"ai"};F(ue=>[...ue,le]),C.success("Soft intro request sent!")}catch(z){console.error("Request soft intro error:",z),C.error("Failed to send soft intro request")}},Je=async(m,N)=>{try{const z=await fetch(`https://${Q}.supabase.co/functions/v1/make-server-2516be19/ai-assistant/soft-intro/respond`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({introRequestId:m,accepted:N})});if(!z.ok)throw new Error("Failed to respond");const _=await z.json();N&&_.chatId&&(C.success("You're now connected! Check your messages."),ae()),F(P=>P.filter(Z=>Z.metadata?.introRequestId!==m))}catch(z){console.error("Handle intro response error:",z),C.error("Failed to process response")}};if(!r&&!f)return e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsx("div",{className:"bg-white border-b px-4 py-4",children:e.jsx("h1",{className:"text-xl font-semibold",children:"Messages"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:k?e.jsx(na,{}):e.jsxs("div",{className:"divide-y",children:[Ce("AI_ASSISTANT_ENABLED")&&e.jsxs("div",{onClick:()=>B(!0),className:"p-4 hover:bg-gray-50 cursor-pointer transition-colors flex items-center gap-3 border-b-2 border-[#2E7B91]/20",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-[#2E7B91] to-[#25658A] rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-baseline justify-between mb-1",children:e.jsx("h3",{className:"font-medium",children:"Link - AI Assistant"})}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:"Find co-founders, study partners, and connections"})]})]}),a.length===0?e.jsx(Me,{type:"no-chats",description:"Your conversations will appear here once you start messaging."}):a.map(m=>!m?.chatId||!m?.otherUser?(ma.warn("Invalid chat data:",m),null):e.jsxs("div",{onClick:()=>h(m),onKeyDown:N=>{(N.key==="Enter"||N.key===" ")&&(N.preventDefault(),h(m))},role:"button",tabIndex:0,"aria-label":`Chat with ${m.otherUser?.name||"user"}`,className:"p-4 hover:bg-gray-50 cursor-pointer transition-colors flex items-center gap-3 focus:outline-none focus:ring-2 focus:ring-[#2E7B91]",children:[e.jsxs(ne,{className:"w-14 h-14",children:[e.jsx(ee,{src:m.otherUser?.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-indigo-400 to-purple-400 text-white",children:de(m.otherUser?.name||"User")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[e.jsx("h3",{className:"font-medium",children:m.otherUser?.name||"Unknown"}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.unreadCount>0&&e.jsx("span",{className:"bg-indigo-600 text-white text-xs font-medium rounded-full px-2 py-0.5 min-w-[20px] text-center",children:m.unreadCount}),m.lastMessage&&e.jsx("span",{className:"text-xs text-gray-500",children:ze(m.lastMessageTimestamp||new Date().toISOString())})]})]}),m.lastMessage?e.jsx("p",{className:`text-sm truncate ${m.unreadCount>0?"font-medium text-gray-900":"text-gray-600"}`,children:m.lastMessage}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"Start a conversation"})]})]},m.chatId))]})})]});if(f&&Ce("AI_ASSISTANT_ENABLED")){if(R){const m=[];b.forEach(_=>{_.metadata?.type==="profile-suggestions"&&_.metadata?.profiles&&_.metadata.profiles.forEach(P=>{m.find(Z=>Z.id===P.id)||m.push(P)})});const N=m.findIndex(_=>_.id===R.id),z={...R,age:R.age||20,school:R.school||s?.school||"University",imageUrl:R.profilePicture||R.imageUrl||R.photos?.[0]||"",photos:R.photos||[R.profilePicture].filter(Boolean),bio:R.bio||"",interests:R.interests||[],lookingFor:R.lookingFor||[],personality:R.personality||[]};return e.jsx(qe,{profile:z,onClose:()=>V(null),onNext:()=>{N<m.length-1&&V(m[N+1])},onPrev:()=>{N>0&&V(m[N-1])},hasNext:N<m.length-1,hasPrev:N>0,accessToken:t})}return e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-3 flex items-center gap-3 flex-shrink-0",children:[e.jsx("button",{onClick:()=>{B(!1),M([]),A(null)},className:"p-2 hover:bg-gray-100 rounded-full transition-colors -ml-2",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-[#2E7B91] to-[#25658A] rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"font-medium",children:"Link - AI Assistant"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Finding connections for you"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:b.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-[#2E7B91] to-[#25658A] rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(O,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Hi! I'm Link"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"I can help you find co-founders, study partners, roommates, and friends on campus. Just tell me what you're looking for!"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:["Find a co-founder","Find a study partner","Find a roommate"].map(m=>e.jsx("button",{onClick:()=>{u(m),setTimeout(()=>Be(),100)},className:"px-3 py-1.5 bg-[#2E7B9115] text-[#2E7B91] rounded-full text-sm hover:bg-[#2E7B9120] transition-colors",children:m},m))})]})}):e.jsxs(e.Fragment,{children:[b.map((m,N)=>{const z=m.senderId===s.id,_=m.metadata?.type==="soft-intro-request";return e.jsxs("div",{children:[e.jsxs("div",{className:`flex gap-2 ${z?"flex-row-reverse":"flex-row"}`,children:[!z&&e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-[#2E7B91] to-[#25658A] rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(O,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:`flex flex-col ${z?"items-end":"items-start"} max-w-[75%]`,children:[e.jsx("div",{className:`px-4 py-2 rounded-2xl ${z?"bg-indigo-600 text-white":"bg-gray-100 text-gray-900"}`,children:e.jsx("p",{className:"text-sm leading-relaxed",children:m.content})}),e.jsx("span",{className:"text-xs text-gray-500 mt-1 px-2",children:ze(m.timestamp)})]})]}),_&&m.metadata?.introRequestId&&e.jsx("div",{className:"mt-3 ml-10 max-w-md",children:e.jsx(S,{className:"border-2 border-[#2E7B91]/20 bg-gradient-to-br from-white to-[#F9F6F3] shadow-md",children:e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(ne,{className:"w-12 h-12 ring-2 ring-[#2E7B91]/30",children:[e.jsx(ee,{src:m.metadata.fromUserPhoto}),e.jsx(se,{className:"bg-gradient-to-br from-[#2E7B91] to-[#25658A] text-white font-semibold",children:de(m.metadata.fromUserName||"U")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h4",{className:"font-semibold text-base text-[#1E4F74] mb-0.5",children:[m.metadata.fromUserName||"Someone"," wants to connect"]}),m.metadata.fromUserMajor&&e.jsxs("p",{className:"text-xs text-[#64748b]",children:[m.metadata.fromUserMajor," â€¢ ",m.metadata.fromUserYear||"Student"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Je(m.metadata.introRequestId,!0),className:"flex-1 bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] font-medium shadow-sm min-w-[100px] rounded-md px-4 py-2 flex items-center justify-center gap-1.5 text-sm transition-colors",style:{border:"none",cursor:"pointer"},"data-accept-button":!0,children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("span",{children:"Accept"})]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>Je(m.metadata.introRequestId,!1),className:"flex-1 border-2 border-[#EAEAEA] hover:border-[#2E7B91]/30 hover:bg-[#F9F6F3] font-medium min-w-[100px]",children:[e.jsx(be,{className:"w-4 h-4 mr-1.5"}),"Decline"]})]})]})})}),m.metadata?.type==="profile-suggestions"&&m.metadata?.profiles&&m.metadata.profiles.length>0&&e.jsx("div",{className:"mt-2 ml-10 space-y-3 max-w-md",children:m.metadata.profiles.map(P=>e.jsx(S,{className:"border border-gray-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>V(P),children:e.jsx(G,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(ne,{className:"w-12 h-12",children:[e.jsx(ee,{src:P.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-indigo-400 to-purple-400 text-white",children:de(P.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm",children:P.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[P.major," â€¢ ",P.year]}),P.bio&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:P.bio}),e.jsxs(y,{size:"sm",onClick:Z=>{Z.stopPropagation();const le=x||"I think we could be a great connection!";Ss(P.id,le)},className:"mt-2 w-full bg-[#2E7B91] hover:bg-[#25658A] text-xs",children:[e.jsx(Ke,{className:"w-3 h-3 mr-1"}),"Request Soft Intro"]})]})]})})},P.id))})]},m.id||N)}),n.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 justify-start pt-2",children:n.map((m,N)=>e.jsx("button",{onClick:()=>{u(m),setTimeout(()=>Be(),100)},className:"px-3 py-1.5 bg-[#2E7B9115] text-[#2E7B91] rounded-full text-sm hover:bg-[#2E7B9120] transition-colors",children:m},N))}),D&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-[#2E7B91] to-[#25658A] rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"bg-gray-100 rounded-2xl px-4 py-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]})]})}),e.jsx("div",{className:"bg-white border-t px-4 flex-shrink-0",style:{paddingTop:"0.75rem",paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{value:x,onChange:m=>u(m.target.value),onKeyPress:m=>m.key==="Enter"&&!D&&Be(),placeholder:"Ask Link to find someone...",className:"flex-1",disabled:D}),e.jsx(y,{onClick:Be,disabled:!x.trim()||D,className:"bg-[#2E7B91] hover:bg-[#25658A]",children:e.jsx(fe,{className:"w-4 h-4"})})]})})]})}return r?.otherUser?e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-3 flex items-center gap-3 flex-shrink-0",children:[e.jsx("button",{onClick:()=>h(null),className:"p-2 hover:bg-gray-100 rounded-full transition-colors -ml-2",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsxs(ne,{className:"w-10 h-10",children:[e.jsx(ee,{src:r.otherUser?.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-indigo-400 to-purple-400 text-white",children:de(r.otherUser?.name||"User")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"font-medium",children:r.otherUser?.name||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-600",children:r.otherUser?.major||""})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:[i.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xt,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Say hi to ",r.otherUser?.name,"!"]})]})}):i.map((m,N)=>{const z=m.senderId===s.id,_=N===i.length-1||i[N+1]?.senderId!==m.senderId;return e.jsxs("div",{className:`flex gap-2 ${z?"flex-row-reverse":"flex-row"}`,children:[_?e.jsx(ne,{className:"w-8 h-8",children:z?e.jsxs(e.Fragment,{children:[e.jsx(ee,{src:s.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-indigo-400 to-purple-400 text-white text-xs",children:de(s.name)})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{src:r.otherUser?.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-indigo-400 to-purple-400 text-white text-xs",children:de(r.otherUser?.name||"U")})]})}):e.jsx("div",{className:"w-8"}),e.jsxs("div",{className:`flex flex-col ${z?"items-end":"items-start"} max-w-[70%]`,children:[e.jsx("div",{className:`px-4 py-2 rounded-2xl ${z?"bg-indigo-600 text-white":"bg-gray-100 text-gray-900"}`,children:e.jsx("p",{className:"text-sm leading-relaxed",children:m.content})}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 px-2 ${z?"flex-row-reverse":""}`,children:[e.jsx("span",{className:"text-xs text-gray-500",children:ze(m.timestamp)}),z&&T&&e.jsx("div",{className:"flex items-center",children:m.readBy&&m.readBy.length>0&&m.readBy.includes(r.otherUser?.id)?e.jsx(ut,{className:"w-3.5 h-3.5 text-indigo-400"}):e.jsx(Re,{className:"w-3.5 h-3.5 text-gray-400"})})]})]})]},m.id)}),I&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2",children:[e.jsxs(ne,{className:"w-6 h-6",children:[e.jsx(ee,{src:r.otherUser?.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-indigo-400 to-purple-400 text-white text-xs",children:de(r.otherUser?.name||"U")})]}),e.jsx("div",{className:"bg-gray-100 rounded-2xl px-4 py-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]})]}),e.jsx("div",{className:"bg-white border-t px-4 flex-shrink-0",style:{paddingTop:"0.75rem",paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{value:x,onChange:m=>{u(m.target.value),ks()},onKeyPress:m=>m.key==="Enter"&&He(),placeholder:`Message ${r.otherUser?.name}...`,className:"flex-1",disabled:c}),e.jsx(y,{onClick:He,disabled:!x.trim()||c,className:"bg-indigo-600 hover:bg-indigo-700",children:e.jsx(fe,{className:"w-4 h-4"})})]})})]}):(console.error("Invalid selected chat:",r),h(null),null)}function ua({userProfile:s,accessToken:t}){const[a,l]=d.useState("pending"),[r,h]=d.useState([]),[i,o]=d.useState([]),[x,u]=d.useState([]),[k,E]=d.useState(!0),[c,j]=d.useState(null),[I,L]=d.useState(null);d.useEffect(()=>{$()},[a]);const $=async()=>{E(!0);try{a==="pending"?await U():a==="sent"?await T():await p()}finally{E(!1)}},U=async()=>{try{const n=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/soft-intros/incoming`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Failed to load pending intros");const g=await n.json();h(g.filter(w=>w.status==="pending"))}catch(n){console.error("Load pending intros error:",n),C.error("Failed to load requests")}},T=async()=>{try{const n=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/soft-intros/outgoing`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Failed to load sent intros");const g=await n.json();o(g)}catch(n){console.error("Load sent intros error:",n),C.error("Failed to load sent requests")}},p=async()=>{try{const n=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/connections`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok){const M=await n.text();throw console.error("Failed to load connections:",n.status,M),new Error(`Failed to load connections: ${n.status}`)}const g=await n.json(),w=Array.isArray(g)?g:g.connections||g.data||[];u(w)}catch(n){console.error("Load connections error:",n),C.error("Failed to load connections"),u([])}},f=async n=>{L(n);try{if(!(await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/soft-intro/${n}/accept`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to accept intro");C.success("Connection accepted! You can now chat."),U()}catch(g){console.error("Accept intro error:",g),C.error("Failed to accept connection")}finally{L(null)}},B=async n=>{L(n);try{if(!(await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/soft-intro/${n}/deny`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to deny intro");C.success("Request declined"),U()}catch(g){console.error("Deny intro error:",g),C.error("Failed to decline request")}finally{L(null)}},b=n=>n.split(" ").map(g=>g[0]).join("").toUpperCase().slice(0,2),F=n=>{switch(n){case"accepted":return e.jsx(De,{className:"w-4 h-4 text-green-500"});case"denied":return e.jsx(Qe,{className:"w-4 h-4 text-red-500"});case"pending":return e.jsx(gt,{className:"w-4 h-4 text-yellow-500"});default:return null}};return c?e.jsx(qe,{profile:c,accessToken:t,onClose:()=>j(null),onNext:()=>{},onPrev:()=>{},hasNext:!1,hasPrev:!1}):e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-4",children:[e.jsx("h1",{className:"text-xl font-semibold mb-4",children:"Connections"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:a==="pending"?"default":"outline",size:"sm",onClick:()=>l("pending"),className:a==="pending"?"bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white":"",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Pending",r.length>0&&e.jsx(K,{className:"ml-2 bg-red-500 text-white",children:r.length})]}),e.jsxs(y,{variant:a==="sent"?"default":"outline",size:"sm",onClick:()=>l("sent"),className:a==="sent"?"bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white":"",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Sent"]}),e.jsxs(y,{variant:a==="connections"?"default":"outline",size:"sm",onClick:()=>l("connections"),className:a==="connections"?"bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white":"",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Friends"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:k?e.jsx("div",{className:"p-4",children:e.jsx(ia,{})}):e.jsxs("div",{className:"p-4 space-y-3",children:[a==="pending"&&e.jsx(e.Fragment,{children:r.length===0?e.jsx(Me,{type:"no-connections",description:"When someone sends you a connection request, it will appear here."}):r.map(n=>e.jsx(S,{className:"overflow-hidden hover:shadow-md transition-shadow",children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(ne,{className:"w-16 h-16 cursor-pointer",onClick:()=>j(n.senderProfile),children:[e.jsx(ee,{src:n.senderProfile?.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-[#2E7B91] to-[#25658A] text-white",children:b(n.senderProfile?.name||"U")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium mb-1 cursor-pointer hover:text-[#2E7B91]",onClick:()=>j(n.senderProfile),children:n.senderProfile?.name}),e.jsxs("p",{className:"text-xs text-[#475569] mb-2",children:[n.senderProfile?.school," â€¢ ",n.senderProfile?.major]}),n.analysis&&e.jsx("div",{className:"bg-[#2E7B9115] rounded-2xl p-3 mb-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-[#2E7B91] flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-[#1E4F74] leading-relaxed",children:typeof n.analysis=="string"?n.analysis:n.analysis?.analysis||n.analysis?.recommendation||"You have a great match!"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{size:"sm",onClick:()=>f(n.id),disabled:I===n.id,className:"flex-1 bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white rounded-2xl",children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Accept"]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>B(n.id),disabled:I===n.id,className:"flex-1",children:[e.jsx(Qe,{className:"w-4 h-4 mr-1"}),"Decline"]})]})]})]})})},n.id))}),a==="sent"&&e.jsx(e.Fragment,{children:i.length===0?e.jsx(Me,{type:"no-matches",description:"Find people on the Discover tab and send them connection requests!",actionLabel:"Discover People",onAction:()=>{}}):i.map(n=>e.jsx(S,{className:"overflow-hidden",children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(ne,{className:"w-16 h-16 cursor-pointer",onClick:()=>j(n.receiverProfile),children:[e.jsx(ee,{src:n.receiverProfile?.profilePicture}),e.jsx(se,{className:"bg-gradient-to-br from-[#2E7B91] to-[#25658A] text-white",children:b(n.receiverProfile?.name||"U")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("h3",{className:"font-medium cursor-pointer hover:text-indigo-600",onClick:()=>j(n.receiverProfile),children:n.receiverProfile?.name}),e.jsx("div",{className:"flex items-center gap-1",children:F(n.status)})]}),e.jsxs("p",{className:"text-xs text-[#475569] mb-2",children:[n.receiverProfile?.school," â€¢ ",n.receiverProfile?.major]}),e.jsx(K,{variant:"secondary",className:n.status==="accepted"?"bg-green-100 text-green-700":n.status==="denied"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700",children:n.status==="pending"?"Waiting for response":n.status})]})]})})},n.id))}),a==="connections"&&e.jsx(e.Fragment,{children:x.length===0?e.jsx(Me,{type:"no-connections",description:"Accept connection requests to start building your network!",actionLabel:"Check Pending Requests",onAction:()=>l("pending")}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:x.map(n=>!n||!n.id?(console.warn("Invalid connection data:",n),null):e.jsx(S,{className:"overflow-hidden cursor-pointer hover:shadow-md transition-shadow",onClick:()=>{n.name&&j(n)},children:e.jsxs(G,{className:"p-0",children:[e.jsx("div",{className:"h-32 bg-gradient-to-br from-[#2E7B91] to-[#25658A] relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs(ne,{className:"w-20 h-20 border-4 border-white",children:[e.jsx(ee,{src:n.profilePicture||n.imageUrl}),e.jsx(se,{className:"text-xl bg-white text-[#2E7B91]",children:b(n.name||"U")})]})})}),e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:n.name||"Unknown"}),e.jsx("p",{className:"text-xs text-[#475569]",children:n.major||""})]})]})},n.id))})})]})})]})}function $e({className:s,orientation:t="horizontal",decorative:a=!0,...l}){return e.jsx(Qs,{"data-slot":"separator-root",decorative:a,orientation:t,className:J("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...l})}function pa({userProfile:s,accessToken:t,onComplete:a,onCancel:l}){const[r,h]=d.useState(!1),[i,o]=d.useState({name:s.name||"",age:s.age||"",major:s.major||"",year:s.year||"",bio:s.bio||"",interests:(s.interests||[]).join(", "),lookingFor:(s.lookingFor||[]).map(u=>u.split("-").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ")).join(", "),academicGoals:(s.goals?.academic||[]).map(u=>u.split("-").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ")).join(", "),leisureGoals:(s.goals?.leisure||[]).map(u=>u.split("-").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ")).join(", "),careerGoal:s.goals?.career||"",personalGoal:s.goals?.personal||"",additionalInfo:s.additionalInfo||""}),x=async u=>{u.preventDefault(),h(!0);try{const k=i.interests.split(",").map($=>$.trim()).filter(Boolean),E=i.lookingFor.split(",").map($=>$.trim().toLowerCase().replace(/ /g,"-")).filter(Boolean),c=i.academicGoals.split(",").map($=>$.trim().toLowerCase().replace(/ /g,"-")).filter(Boolean),j=i.leisureGoals.split(",").map($=>$.trim().toLowerCase().replace(/ /g,"-")).filter(Boolean),I={...s,name:i.name,age:parseInt(i.age.toString())||s.age,major:i.major,year:i.year,bio:i.bio,interests:k,lookingFor:E,goals:{academic:c,leisure:j,career:i.careerGoal.trim()||void 0,personal:i.personalGoal.trim()||void 0},additionalInfo:i.additionalInfo.trim()||void 0};if(!(await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/profile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(I)})).ok)throw new Error("Failed to update profile");C.success("Profile updated! ðŸŽ‰"),a()}catch(k){console.error("Update profile error:",k),C.error("Failed to update profile")}finally{h(!1)}};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-3 flex items-center gap-3 sticky top-0 z-10",children:[e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-full transition-colors -ml-2",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Profile"})]}),e.jsxs("form",{onSubmit:x,className:"p-4 space-y-4 max-w-2xl mx-auto",children:[e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"name",children:"Name"}),e.jsx(X,{id:"name",value:i.name,onChange:u=>o({...i,name:u.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"age",children:"Age"}),e.jsx(X,{id:"age",type:"number",value:i.age,onChange:u=>o({...i,age:u.target.value})})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"year",children:"Year"}),e.jsx(X,{id:"year",value:i.year,onChange:u=>o({...i,year:u.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"major",children:"Major"}),e.jsx(X,{id:"major",value:i.major,onChange:u=>o({...i,major:u.target.value})})]})]})}),e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:"About"}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"bio",children:"Bio"}),e.jsx(Oe,{id:"bio",value:i.bio,onChange:u=>o({...i,bio:u.target.value}),rows:4,placeholder:"Tell people about yourself..."})]})]})}),e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Interests"}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"interests",children:"Interests (comma-separated)"}),e.jsx(X,{id:"interests",value:i.interests,onChange:u=>o({...i,interests:u.target.value}),placeholder:"e.g., Music, Sports, Reading"})]})]})}),e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Looking For"}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"lookingFor",children:"Looking For (comma-separated)"}),e.jsx(X,{id:"lookingFor",value:i.lookingFor,onChange:u=>o({...i,lookingFor:u.target.value}),placeholder:"e.g., Friends, Study Partner, Roommate"})]})]})}),e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Goals"}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"academicGoals",children:"Academic Goals (comma-separated)"}),e.jsx(X,{id:"academicGoals",value:i.academicGoals,onChange:u=>o({...i,academicGoals:u.target.value}),placeholder:"e.g., Get Straight A's, Graduate Early"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"leisureGoals",children:"Leisure Goals (comma-separated)"}),e.jsx(X,{id:"leisureGoals",value:i.leisureGoals,onChange:u=>o({...i,leisureGoals:u.target.value}),placeholder:"e.g., Learn Guitar, Travel More"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"careerGoal",children:"Career Goal"}),e.jsx(X,{id:"careerGoal",value:i.careerGoal,onChange:u=>o({...i,careerGoal:u.target.value}),placeholder:"e.g., Become a Software Engineer"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"personalGoal",children:"Personal Goal"}),e.jsx(X,{id:"personalGoal",value:i.personalGoal,onChange:u=>o({...i,personalGoal:u.target.value}),placeholder:"e.g., Build Better Habits"})]})]})}),e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Additional Information"}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"additionalInfo",children:"Anything else we should know?"}),e.jsx(Oe,{id:"additionalInfo",value:i.additionalInfo,onChange:u=>o({...i,additionalInfo:u.target.value}),rows:3,placeholder:"Help Link find better connections for you..."})]})]})}),e.jsxs("div",{className:"flex gap-3 pb-8",children:[e.jsx(y,{type:"button",variant:"outline",onClick:l,className:"flex-1",disabled:r,children:"Cancel"}),e.jsxs(y,{type:"submit",className:"flex-1 bg-[#2E7B91] hover:bg-[#25658A]",disabled:r,children:[e.jsx(ft,{className:"w-4 h-4 mr-2"}),r?"Saving...":"Save Changes"]})]})]})]})}function Se({className:s,...t}){return e.jsx(Zs,{"data-slot":"switch",className:J("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Xs,{"data-slot":"switch-thumb",className:J("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function ga({userProfile:s,onComplete:t}){const a=()=>{const i=[];let o=0;const x=100;return s?.name?o+=10:i.push("Name"),s?.photos&&s.photos.length>0?o+=10:i.push("Profile Photo"),s?.bio?o+=10:i.push("Bio"),s?.school?o+=10:i.push("School"),s?.major?o+=10:i.push("Major"),s?.year?o+=10:i.push("Year"),s?.interests&&s.interests.length>0?o+=10:i.push("Interests"),s?.lookingFor&&s.lookingFor.length>0?o+=10:i.push("Looking For"),s?.bondPrint?o+=10:i.push("Bond Print"),s?.goals&&(s.goals.academic?.length>0||s.goals.leisure?.length>0)?o+=10:i.push("Goals"),{percentage:Math.min(o,x),missing:i}},{percentage:l,missing:r}=a(),h=l>=80;return h&&!t?null:e.jsx(S,{className:`${h?"border-green-200 bg-green-50/50":"border-yellow-200 bg-yellow-50/50"}`,children:e.jsxs(G,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[h?e.jsx(De,{className:"w-5 h-5 text-green-600"}):e.jsx(jt,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h3",{className:"font-medium text-[#1E4F74]",children:"Profile Completeness"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-[#475569]",children:[l,"% Complete"]}),h&&e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Great job! ðŸŽ‰"})]}),e.jsx(oe,{value:l,className:"h-2"})]}),!h&&r.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#64748b] mb-2",children:"Add these to improve your profile:"}),e.jsxs("ul",{className:"text-xs text-[#475569] space-y-1",children:[r.slice(0,3).map(i=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-500"}),i]},i)),r.length>3&&e.jsxs("li",{className:"text-[#64748b]",children:["+",r.length-3," more"]})]})]}),t&&!h&&e.jsx(y,{onClick:t,size:"sm",className:"w-full bg-gradient-to-r from-[#2E7B91] to-[#25658A] hover:from-[#25658A] hover:to-[#1E4F74] text-white",children:"Complete Profile"})]})]})})}function fa({userProfile:s,accessToken:t,onLogout:a}){const[l,r]=d.useState("profile"),[h,i]=d.useState(!1),[o,x]=d.useState({profileVisible:!0,showOnlineStatus:!0,allowMessages:!0,notifications:!0,readReceipts:s?.settings?.readReceipts!==void 0?s.settings.readReceipts:!0}),u=c=>c.split(" ").map(j=>j[0]).join("").toUpperCase().slice(0,2),k=()=>s.livingHabits?.sleepSchedule==="early"?e.jsx(Ct,{className:"w-4 h-4"}):s.livingHabits?.sleepSchedule==="night"?e.jsx(At,{className:"w-4 h-4"}):e.jsx(O,{className:"w-4 h-4"}),E=c=>{r("profile"),window.location.reload()};return l==="edit"?e.jsx(pa,{userProfile:s,accessToken:t,onComplete:E,onCancel:()=>r("profile")}):l==="settings"?e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>r("profile"),className:"p-2 hover:bg-gray-100 rounded-full transition-colors -ml-2",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl",children:"Settings"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Account"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email})]}),e.jsx($e,{}),e.jsxs(y,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>r("edit"),children:[e.jsx(Ze,{className:"w-4 h-4"}),"Edit Profile"]})]})}),e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"font-medium",children:"Privacy"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"profile-visible",className:"text-sm font-medium",children:"Profile Visible"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Allow others to see your profile"})]}),e.jsx(Se,{id:"profile-visible",checked:o.profileVisible,onCheckedChange:c=>x({...o,profileVisible:c})})]}),e.jsx($e,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"online-status",className:"text-sm font-medium",children:"Show Online Status"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Let others see when you're active"})]}),e.jsx(Se,{id:"online-status",checked:o.showOnlineStatus,onCheckedChange:c=>x({...o,showOnlineStatus:c})})]}),e.jsx($e,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"allow-messages",className:"text-sm font-medium",children:"Allow Direct Messages"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Anyone can send you messages"})]}),e.jsx(Se,{id:"allow-messages",checked:o.allowMessages,onCheckedChange:c=>x({...o,allowMessages:c})})]}),e.jsx($e,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"read-receipts",className:"text-sm font-medium",children:"Read Receipts"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Let others know when you've read their messages"})]}),e.jsx(Se,{id:"read-receipts",checked:o.readReceipts,onCheckedChange:async c=>{x({...o,readReceipts:c});try{if(!(await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/profile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({...s,settings:{...s?.settings,readReceipts:c}})})).ok)throw new Error("Failed to save settings")}catch(j){console.error("Save settings error:",j),C.error("Failed to save settings")}}})]})]})}),e.jsx(S,{children:e.jsxs(G,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(bt,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"font-medium",children:"Notifications"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"notifications",className:"text-sm font-medium",children:"Push Notifications"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Get notified about new messages and requests"})]}),e.jsx(Se,{id:"notifications",checked:o.notifications,onCheckedChange:c=>x({...o,notifications:c})})]})]})}),e.jsx(S,{className:"border-red-200",children:e.jsxs(G,{className:"pt-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-600 mb-1",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Irreversible actions that affect your account"})]}),e.jsxs(y,{variant:"outline",className:"w-full justify-start gap-2 text-red-600 border-red-300 hover:bg-red-50",onClick:()=>i(!0),children:[e.jsx(vt,{className:"w-4 h-4"}),"Logout"]})]})})]})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl",children:"My Profile"}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>r("settings"),children:e.jsx(Xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(ga,{userProfile:s,onComplete:()=>r("edit")}),e.jsx(S,{children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-32 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-t-lg"}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ne,{className:"w-24 h-24 border-4 border-white -mt-12 mb-3",children:[e.jsx(ee,{src:s.profilePicture}),e.jsx(se,{className:"text-2xl bg-gradient-to-br from-indigo-400 to-purple-400 text-white",children:u(s.name)})]}),e.jsx("button",{className:"absolute left-16 -mt-8 bg-white rounded-full p-2 shadow-lg hover:shadow-xl transition-shadow",children:e.jsx(yt,{className:"w-4 h-4 text-gray-600"})})]}),e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl mb-1",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{children:s.year||"Student"}),s.major&&e.jsxs("span",{children:["â€¢ ",s.major]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{children:s.school})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("span",{children:s.email})]})]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>r("edit"),className:"gap-2",children:[e.jsx(Ze,{className:"w-3 h-3"}),"Edit"]})]})]})]})}),s.bondPrint&&e.jsx(S,{className:"border-2 border-purple-200 bg-gradient-to-br from-purple-50 to-pink-50",children:e.jsxs(G,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(O,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"font-medium",children:"Your Bond Print"})]}),s.bondPrint.personality&&e.jsxs("div",{className:"mb-3",children:[e.jsx(K,{className:"bg-purple-600 text-white mb-2",children:s.bondPrint.personality.primaryType}),e.jsx("p",{className:"text-sm text-gray-700",children:s.bondPrint.personality.description})]}),s.bondPrint.summary&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.bondPrint.summary}),s.bondPrint.values&&s.bondPrint.values.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Core Values:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.bondPrint.values.map(c=>e.jsx(K,{variant:"outline",className:"text-xs border-purple-300",children:c},c))})]})]})}),s.bio&&e.jsx(S,{children:e.jsxs(G,{className:"pt-6",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"About"}),e.jsx("p",{className:"text-gray-700",children:s.bio})]})}),s.lookingFor&&s.lookingFor.length>0&&e.jsx(S,{children:e.jsxs(G,{className:"pt-6",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-3",children:"Looking For"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.lookingFor.map(c=>{const j=c.split("-").map(I=>I.charAt(0).toUpperCase()+I.slice(1)).join(" ");return e.jsx(K,{className:"bg-indigo-100 text-indigo-700 hover:bg-indigo-200 whitespace-nowrap",children:j},c)})})]})}),s.interests&&s.interests.length>0&&e.jsx(S,{children:e.jsxs(G,{className:"pt-6",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-3",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.interests.map(c=>e.jsx(K,{variant:"outline",children:c},c))})]})}),s.personality&&s.personality.length>0&&e.jsx(S,{children:e.jsxs(G,{className:"pt-6",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-3",children:"Personality"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.personality.map(c=>e.jsx(K,{variant:"secondary",children:c},c))})]})}),s.livingHabits&&e.jsx(S,{children:e.jsxs(G,{className:"pt-6",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-4",children:"Living Habits"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.livingHabits.sleepSchedule&&e.jsxs("div",{className:"flex items-center gap-2",children:[k(),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Sleep"}),e.jsx("p",{className:"text-sm capitalize",children:s.livingHabits.sleepSchedule})]})]}),s.livingHabits.cleanliness&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Cleanliness"}),e.jsx("p",{className:"text-sm capitalize",children:s.livingHabits.cleanliness})]})]}),s.livingHabits.guests&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Guests"}),e.jsx("p",{className:"text-sm capitalize",children:s.livingHabits.guests})]})]}),s.livingHabits.noise&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Noise"}),e.jsx("p",{className:"text-sm capitalize",children:s.livingHabits.noise})]})]})]})]})}),s.socials&&e.jsx(S,{children:e.jsxs(G,{className:"pt-6",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-3",children:"Social Media"}),e.jsxs("div",{className:"space-y-2",children:[s.socials.instagram&&e.jsxs("a",{href:`https://instagram.com/${s.socials.instagram.replace("@","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-indigo-600 hover:underline",children:[e.jsx(os,{className:"w-4 h-4"}),s.socials.instagram]}),s.socials.twitter&&e.jsxs("a",{href:`https://x.com/${s.socials.twitter.replace("@","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-indigo-600 hover:underline",children:[e.jsx(St,{className:"w-4 h-4"}),s.socials.twitter]}),s.socials.snapchat&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Snapchat:"}),e.jsx("span",{children:s.socials.snapchat})]})]})]})}),e.jsx(S,{children:e.jsx(G,{className:"pt-6 space-y-2",children:e.jsxs(y,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>r("settings"),children:[e.jsx(Xe,{className:"w-4 h-4"}),"Settings & Privacy"]})})})]}),e.jsx(fs,{open:h,onOpenChange:i,children:e.jsxs(bs,{children:[e.jsxs(vs,{children:[e.jsx(ys,{children:"Logout?"}),e.jsx(Ns,{children:"Are you sure you want to logout? You'll need to sign in again to access your account."})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx(y,{variant:"outline",className:"flex-1",onClick:()=>i(!1),children:"Cancel"}),e.jsx(y,{className:"flex-1 bg-red-600 hover:bg-red-700",onClick:()=>{i(!1),a()},children:"Logout"})]})]})})]})}function ja({mode:s,onChange:t}){return e.jsx("div",{className:`${he.components.navigation.header} px-4 py-4`,children:e.jsx("div",{className:`${he.layout.maxWidth} mx-auto`,children:e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-full p-1",children:[e.jsxs("button",{onClick:()=>t("friend"),className:`flex-1 relative py-2.5 px-4 rounded-full ${he.transition.default}`,children:[s==="friend"&&e.jsx(Y.div,{layoutId:"mode-indicator",className:"absolute inset-0 bg-white rounded-full shadow-md",transition:{type:"spring",duration:.5,bounce:.2}}),e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsx(je,{className:`w-4 h-4 ${s==="friend"?"text-indigo-600":"text-gray-500"}`}),e.jsx("span",{className:`font-medium ${s==="friend"?"text-indigo-600":"text-gray-500"}`,children:"Friend Mode"})]})]}),e.jsxs("button",{onClick:()=>t("love"),className:`flex-1 relative py-2.5 px-4 rounded-full ${he.transition.default}`,children:[s==="love"&&e.jsx(Y.div,{layoutId:"mode-indicator",className:`absolute inset-0 bg-gradient-to-r ${he.colors.love.gradient} rounded-full shadow-md`,transition:{type:"spring",duration:.5,bounce:.2}}),e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsx(te,{className:`w-4 h-4 ${s==="love"?"text-white":"text-gray-500"}`}),e.jsx("span",{className:`font-medium ${s==="love"?"text-white":"text-gray-500"}`,children:"Love Mode"})]})]})]})})})}function ba({onActivate:s,onCancel:t}){const[a,l]=d.useState(1),r=[{icon:te,color:"from-pink-500 to-red-500",title:"Activating Love Mode",subtitle:"A different kind of dating experience",content:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:"Love Mode is designed for meaningful romantic connections using AI-powered matching and progressive stages that build emotional intimacy."}),e.jsxs("div",{className:"bg-pink-50 border border-pink-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-pink-900 mb-2",children:"How it differs from Friend Mode:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-pink-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-pink-600 mt-0.5",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Distance-based:"})," See people near you from any school"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-pink-600 mt-0.5",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Anonymous start:"})," Matches begin with AI-generated aliases"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-pink-600 mt-0.5",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"AI matching:"})," Link combines personality & attraction for perfect matches"]})]})]})]})]})},{icon:Et,color:"from-purple-500 to-pink-500",title:"How Love Mode Works",subtitle:"4 simple steps to meaningful connection",content:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-medium",children:"1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"Rate Profiles"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View profiles and honestly rate 1-10. Your ratings are private."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-medium",children:"2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"AI Analyzes Compatibility"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Link's AI combines your ratings with personality insights to create meaningful blind matches."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-medium",children:"3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"Chat Anonymously"}),e.jsx("p",{className:"text-sm text-gray-600",children:'Start with aliases like "Calm Fox" - no names or photos yet.'})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-purple-700 font-medium",children:"4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"Progress Through Stages"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Text â†’ Voice â†’ Reveal â†’ Date. Build connection step by step."})]})]})]})})},{icon:Ee,color:"from-red-500 to-pink-500",title:"Privacy & Safety",subtitle:"Your safety is our priority",content:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"Anonymous Start"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Every match begins anonymously. Real identities unlock only when both users progress through stages."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"AI Moderation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Link monitors all conversations for safety, providing guidance and detecting concerning behavior."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"Private Ratings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your ratings are never shown to others. Only you and Link know how you rated someone."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ms,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:"Distance-Based"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Unlike Friend Mode (school-only), Love Mode shows people near you from any school."})]})]})]})}],h=r[a-1],i=h.icon;return e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-pink-50 via-purple-50 to-red-50 overflow-y-auto p-4",style:{height:"100vh",height:"100dvh",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y"},children:e.jsx("div",{className:"min-h-full flex items-center justify-center py-8",children:e.jsx(Y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-lg",children:e.jsx(S,{className:"shadow-2xl",children:e.jsxs(G,{className:"pt-8 pb-6 px-6",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-6",children:r.map((o,x)=>e.jsx("div",{className:`h-2 rounded-full transition-all ${x+1===a?"w-8 bg-gradient-to-r "+h.color:x+1<a?"w-2 bg-purple-400":"w-2 bg-gray-300"}`},x))}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(Y.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",duration:.6},className:`w-20 h-20 rounded-full bg-gradient-to-br ${h.color} flex items-center justify-center shadow-lg`,children:e.jsx(i,{className:"w-10 h-10 text-white"})},a)}),e.jsxs(Y.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3},className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl mb-2",children:h.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:h.subtitle}),e.jsx("div",{className:"text-left",children:h.content})]},a),e.jsxs("div",{className:"flex gap-3",children:[a>1?e.jsx(y,{variant:"outline",onClick:()=>l(a-1),className:"flex-1",children:"Back"}):e.jsx(y,{variant:"outline",onClick:t,className:"flex-1",children:"Cancel"}),a<r.length?e.jsx(y,{onClick:()=>l(a+1),className:`flex-1 bg-gradient-to-r ${h.color} hover:opacity-90 text-white`,children:"Next"}):e.jsxs(y,{onClick:s,className:`flex-1 bg-gradient-to-r ${h.color} hover:opacity-90 text-white gap-2`,children:[e.jsx(hs,{className:"w-4 h-4"}),"Activate Love Mode"]})]})]})})})})})}function va({userProfile:s,accessToken:t,onRatingComplete:a}){const[l,r]=d.useState([]),[h,i]=d.useState(0),[o,x]=d.useState(!0),[u,k]=d.useState(!1),[E,c]=d.useState(0),[j,I]=d.useState(!0),L=us(0),$=ts(L,[-200,200],[-30,30]),U=ts(L,[-200,-100,0,100,200],[0,1,1,1,0]);d.useEffect(()=>{T()},[]);const T=async()=>{x(!0);try{const F=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/discover`,{headers:{Authorization:`Bearer ${t}`}});if(!F.ok)throw new Error("Failed to load profiles");const n=await F.json();r(n.profiles||[])}catch(F){console.error("Load profiles error:",F),C.error("Failed to load profiles")}finally{x(!1)}},p=async F=>{if(u)return;const n=l[h];if(n){k(!0);try{if(!(await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/rate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({ratedUserId:n.id,rating:F})})).ok)throw new Error("Failed to submit rating");c(E+1),h<l.length-1?i(h+1):(C.success("Great work! Your AI is learning your type.",{duration:3e3}),a())}catch(g){console.error("Submit rating error:",g),C.error("Failed to submit rating")}finally{k(!1)}}},f=(F,n)=>{if(Math.abs(n.offset.x)>50){const w=n.offset.x>0?Math.min(10,Math.ceil(n.offset.x/200*10)):Math.max(1,10-Math.ceil(Math.abs(n.offset.x)/200*10));p(w)}},B=F=>{p(F)};if(o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50",children:e.jsxs(Y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[e.jsx(O,{className:"w-12 h-12 text-pink-500 mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-gray-600",children:"Finding profiles for you..."})]})});if(l.length===0)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 p-4",children:e.jsxs(S,{className:"max-w-md w-full p-8 text-center",children:[e.jsx(te,{className:"w-16 h-16 text-pink-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You've rated everyone available. Check back soon for new profiles!"}),e.jsx(y,{onClick:a,className:"w-full",children:"View Matches"})]})});const b=l[h];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-pink-100 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-pink-500"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Rate Phase"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(K,{variant:"secondary",className:"bg-pink-50 text-pink-700 border-pink-200",children:[E," rated"]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>I(!j),children:e.jsx(It,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-3 h-1.5 bg-pink-100 rounded-full overflow-hidden",children:e.jsx(Y.div,{className:"h-full bg-gradient-to-r from-pink-500 to-purple-500",initial:{width:"0%"},animate:{width:`${h/l.length*100}%`},transition:{duration:.3}})})]})}),e.jsx(Ie,{children:j&&e.jsx(Y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-md mx-auto px-4 pt-4",children:e.jsx(S,{className:"p-4 bg-gradient-to-r from-pink-50 to-purple-50 border-pink-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-pink-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"How It Works"}),e.jsxs("p",{className:"text-gray-600",children:["Rate based on ",e.jsx("span",{className:"font-medium",children:"instinctual attraction"})," (1-10). This trains Bonded's AI to understand your visual preferences.",e.jsx("span",{className:"block mt-1 text-pink-600",children:"â†’ Swipe right for higher ratings, left for lower"})]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>I(!1),className:"flex-shrink-0",children:e.jsx(be,{className:"w-4 h-4"})})]})})})}),e.jsx("div",{className:"max-w-md mx-auto px-4 py-6 flex items-center justify-center min-h-[600px]",children:e.jsx("div",{className:"relative w-full max-w-sm aspect-[3/4]",children:e.jsx(Ie,{children:b&&e.jsx(Y.div,{className:"absolute inset-0",style:{x:L,rotate:$,opacity:U},drag:"x",dragConstraints:{left:0,right:0},onDragEnd:f,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},children:e.jsxs(S,{className:"h-full overflow-hidden shadow-2xl border-2 border-white",children:[e.jsxs("div",{className:"relative h-3/4 bg-gradient-to-br from-pink-100 to-purple-100",children:[b.profilePicture||b.photos?.[0]?e.jsx("img",{src:b.profilePicture||b.photos[0],alt:b.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(te,{className:"w-24 h-24 text-pink-300"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4",children:[e.jsxs("h3",{className:"text-3xl font-bold text-white mb-1",children:[b.name,", ",b.year||"22"]}),e.jsx("p",{className:"text-white/90 text-sm",children:b.school})]})]}),e.jsx("div",{className:"h-1/4 p-4 bg-white",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.major&&e.jsx(K,{variant:"secondary",className:"text-xs",children:b.major}),b.interests?.slice(0,2).map(F=>e.jsx(K,{variant:"outline",className:"text-xs",children:F},F))]})})]})},b.id)})})}),e.jsx("div",{className:"max-w-md mx-auto px-4 pb-8",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-100",children:[e.jsx("p",{className:"text-center text-sm text-gray-600 mb-4",children:"Rate your attraction level"}),e.jsx("div",{className:"grid grid-cols-10 gap-2 mb-4",children:[1,2,3,4,5,6,7,8,9,10].map(F=>e.jsx(y,{onClick:()=>B(F),disabled:u,className:`
                  h-12 p-0 text-sm font-semibold transition-all
                  ${F<=3?"bg-gray-200 hover:bg-gray-300 text-gray-700":F<=6?"bg-blue-200 hover:bg-blue-300 text-blue-700":F<=8?"bg-purple-200 hover:bg-purple-300 text-purple-700":"bg-pink-500 hover:bg-pink-600 text-white"}
                `,children:F},F))}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-1",children:[e.jsx("span",{children:"Not My Type"}),e.jsx("span",{children:"Very Attractive"})]})]})})]})}const ge=[{id:"communication_style",category:"Communication",question:"In a meaningful conversation, I prefer...",type:"single",options:["Deep emotional discussions about feelings","Intellectual debates and ideas","Light-hearted, playful banter","Problem-solving and practical talk"]},{id:"emotional_expression",category:"Emotional Style",question:"I express affection through...",type:"multiple",options:["Words of affirmation and compliments","Physical touch and closeness","Quality time and undivided attention","Acts of service and helping","Thoughtful gifts and surprises"]},{id:"vulnerability_comfort",category:"Emotional Openness",question:"When it comes to being vulnerable...",type:"single",options:["I open up easily and share deeply early on","I need trust first, then gradually open up","I struggle with vulnerability but try","I prefer keeping emotional walls up"]},{id:"attachment_style",category:"Attachment",question:"In relationships, I tend to...",type:"single",options:["Crave closeness and reassurance often (Anxious)","Value independence and personal space (Avoidant)","Balance intimacy with autonomy naturally (Secure)","Fluctuate between wanting closeness and distance (Fearful)"]},{id:"conflict_response",category:"Conflict",question:"When there's tension or disagreement, I...",type:"single",options:["Address it immediatelyâ€”I need to resolve things","Need time and space to process my feelings","Try to keep the peace and avoid confrontation","Get overwhelmed emotionally and need comfort"]},{id:"reassurance_needs",category:"Emotional Needs",question:"I feel most secure when my partner...",type:"single",options:["Frequently tells me they love me and appreciate me","Gives me freedom and doesn't cling","Shows consistency in words and actions","Understands my moods without me explaining"]},{id:"dating_pace",category:"Dating Pace",question:"My ideal relationship timeline is...",type:"single",options:["Slow burnâ€”friendship first, romance later","Natural flowâ€”see where things go organically","Fast connectionâ€”when it clicks, it clicks","Intentionalâ€”clear communication from the start"]},{id:"emotional_intensity",category:"Emotional Depth",question:"How do you approach emotional intimacy?",type:"single",options:["I crave deep emotional connection quickly","I prefer gradual emotional deepening","I'm comfortable with surface-level connection","I alternate between intense and distant"]},{id:"ideal_connection",category:"Connection Type",question:"The most important connection for me is...",type:"rank",options:["Emotional intimacy and understanding","Physical chemistry and attraction","Intellectual stimulation and deep talks","Shared values and life goals","Having fun and laughing together"]},{id:"relationship_priority",category:"Priorities",question:"In a partner, I value most...",type:"rank",options:["Emotional availability and empathy","Reliability and consistency","Passion and spontaneity","Ambition and drive","Kindness and compassion"]},{id:"alone_time_needs",category:"Personal Space",question:"My need for alone time is...",type:"scale",scale:{min:1,max:10,minLabel:"Need constant togetherness",maxLabel:"Need lots of solo time"}},{id:"emotional_availability",category:"Emotional Readiness",question:"Right now, I'm emotionally ready for...",type:"single",options:["A serious, committed relationship","Dating with intention, open to commitment","Casual dating, seeing what happens","Just exploring and meeting people"]},{id:"past_patterns",category:"Self-Awareness",question:"In past relationships, I've noticed I...",type:"multiple",options:["Get anxious when they pull away","Pull away when things get too close","Overthink and need constant communication","Struggle to express my needs clearly","Have a secure, balanced approach"]},{id:"love_beliefs",category:"Beliefs About Love",question:"I believe love should be...",type:"single",options:["Effortless and naturalâ€”if it's right, it's easy","Work and commitmentâ€”love is a choice","Passionate and intenseâ€”deep emotional highs","Balancedâ€”effort, passion, and stability"]},{id:"deal_breakers",category:"Non-Negotiables",question:"What would be hardest for you in a relationship?",type:"single",options:["Lack of emotional communication","Not enough quality time together","Feeling controlled or smothered","Inconsistency or unreliability"]}];function ya({onComplete:s,onSkip:t}){const[a,l]=d.useState(0),[r,h]=d.useState({}),[i,o]=d.useState([]),[x,u]=d.useState([]),[k,E]=d.useState(5),c=ge[a],j=(a+1)/ge.length*100,I=f=>{h({...r,[c.id]:f})},L=f=>{const B=i.includes(f)?i.filter(b=>b!==f):[...i,f];o(B)},$=(f,B)=>{const b=x.length>0?x:c.options,F=b.indexOf(f),n=[...b];n.splice(F,1),n.splice(B,0,f),u(n)},U=()=>c.type==="single"?r[c.id]!==void 0:c.type==="multiple"?i.length>0:c.type==="rank"?x.length===c.options.length:c.type==="scale",T=()=>{let f;c.type==="multiple"?f=i:c.type==="rank"?f=x.length>0?x:c.options:c.type==="scale"?f=k:f=r[c.id];const B={...r,[c.id]:f};if(h(B),a<ge.length-1)l(a+1),o([]),u([]),E(5);else{const b={answers:B,profile:Na(B),completedAt:new Date().toISOString()};s(b)}},p=()=>{if(a>0){l(a-1);const f=ge[a-1],B=r[f.id];f.type==="multiple"&&Array.isArray(B)?o(B):f.type==="rank"&&Array.isArray(B)?u(B):f.type==="scale"&&typeof B=="number"&&E(B)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[e.jsx(_e,{className:"w-8 h-8 text-purple-500"}),e.jsx(O,{className:"w-6 h-6 text-pink-500"})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Love Print Quiz"}),e.jsx("p",{className:"text-gray-600",children:"Understand your emotional patterns & attachment style"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Question ",a+1," of ",ge.length]}),e.jsxs("span",{className:"text-sm font-semibold text-purple-600",children:[Math.round(j),"%"]})]}),e.jsx(oe,{value:j,className:"h-2"})]}),e.jsx(Ie,{mode:"wait",children:e.jsx(Y.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:e.jsxs(S,{className:"p-8 mb-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-50 text-purple-700 border border-purple-200",children:c.category})}),e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-900",children:c.question}),e.jsxs("div",{className:"space-y-3",children:[c.type==="single"&&c.options.map((f,B)=>e.jsx(y,{variant:r[c.id]===f?"default":"outline",className:`
                      w-full justify-start text-left h-auto py-4 px-6
                      ${r[c.id]===f?"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-transparent":"hover:border-purple-300"}
                    `,onClick:()=>I(f),children:e.jsx("span",{className:"text-base",children:f})},B)),c.type==="multiple"&&c.options.map((f,B)=>e.jsx(y,{variant:i.includes(f)?"default":"outline",className:`
                      w-full justify-start text-left h-auto py-4 px-6
                      ${i.includes(f)?"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-transparent":"hover:border-purple-300"}
                    `,onClick:()=>L(f),children:e.jsx("span",{className:"text-base",children:f})},B)),c.type==="rank"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Drag to rank from most to least important"}),(x.length>0?x:c.options).map((f,B)=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white border-2 border-gray-200 rounded-lg cursor-move hover:border-purple-300",draggable:!0,onDragStart:b=>b.dataTransfer.setData("text/plain",f),onDragOver:b=>b.preventDefault(),onDrop:b=>{b.preventDefault();const F=b.dataTransfer.getData("text/plain");$(F,B)},children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 text-purple-700 font-semibold text-sm",children:B+1}),e.jsx("span",{className:"text-base",children:f})]},f))]}),c.type==="scale"&&c.scale&&e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{className:"text-sm text-gray-600",children:c.scale.minLabel}),e.jsx("span",{className:"text-sm text-gray-600",children:c.scale.maxLabel})]}),e.jsx("input",{type:"range",min:c.scale.min,max:c.scale.max,value:k,onChange:f=>E(Number(f.target.value)),className:"w-full h-3 bg-purple-100 rounded-lg appearance-none cursor-pointer accent-purple-500"}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("span",{className:"text-3xl font-bold text-purple-600",children:k}),e.jsxs("span",{className:"text-gray-600",children:[" / ",c.scale.max]})]})]})]}),c.type==="multiple"&&e.jsxs("p",{className:"text-sm text-gray-500 mt-4",children:["Select all that apply (",i.length," selected)"]})]})},a)}),e.jsxs("div",{className:"flex gap-3",children:[a>0&&e.jsxs(y,{variant:"outline",onClick:p,className:"flex-1",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx(y,{onClick:T,disabled:!U(),className:"flex-1 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:a===ge.length-1?e.jsxs(e.Fragment,{children:["Complete",e.jsx(te,{className:"w-4 h-4 ml-2"})]}):e.jsxs(e.Fragment,{children:["Next",e.jsx(Bt,{className:"w-4 h-4 ml-2"})]})})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(y,{variant:"ghost",onClick:t,className:"text-gray-500 hover:text-gray-700",children:"Skip for now"})})]})})}function Na(s){return{communicationStyle:s.communication_style||"Balanced",emotionalOpenness:s.vulnerability_comfort||"Gradual",attachmentStyle:s.attachment_style||"Secure",conflictStyle:s.conflict_response||"Direct",loveLanguages:s.emotional_expression||[],intimacyPace:s.dating_pace||"Natural",emotionalIntensity:s.emotional_intensity||"Moderate",priorities:s.relationship_priority||[],idealConnection:s.ideal_connection||[],spaceNeeds:s.alone_time_needs||5,emotionalReadiness:s.emotional_availability||"Open",pastPatterns:s.past_patterns||[],loveBeliefs:s.love_beliefs||"Balanced",dealBreakers:s.deal_breakers||[]}}function wa({relationship:s,userProfile:t,accessToken:a,onBack:l,onRevealRequested:r}){const[h,i]=d.useState([]),[o,x]=d.useState(""),[u,k]=d.useState(!0),[E,c]=d.useState(!1),[j,I]=d.useState(s),[L,$]=d.useState([]),[U,T]=d.useState(!1),[p,f]=d.useState(s.bondStrength||0),B=d.useRef(null),b=d.useRef(null);d.useEffect(()=>(n(),b.current=setInterval(()=>{n(!0)},3e3),()=>{b.current&&clearInterval(b.current)}),[s.id]),d.useEffect(()=>{F()},[h]),d.useEffect(()=>{h.length>0&&h.length%5===0&&g()},[h.length]);const F=()=>{B.current?.scrollIntoView({behavior:"smooth"})},n=async(v=!1)=>{v||k(!0);try{const R=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/messages/${s.id}`,{headers:{Authorization:`Bearer ${a}`}});if(!R.ok)throw new Error("Failed to load messages");const V=await R.json();i(V.messages||[]),V.relationship&&(I(V.relationship),f(V.relationship.bondStrength||0),V.relationship.bondStrength>=75&&!V.relationship.revealed&&M())}catch(R){console.error("Load messages error:",R),v||C.error("Failed to load messages")}finally{v||k(!1)}},g=async()=>{try{const v=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/link-suggestions/${s.id}`,{headers:{Authorization:`Bearer ${a}`}});if(v.ok){const R=await v.json();$(R.suggestions||[])}}catch(v){console.error("Load Link suggestions error:",v)}},w=async v=>{if(!(!v.trim()||E)){c(!0),x("");try{const R=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/send-message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({relationshipId:s.id,content:v})});if(!R.ok)throw new Error("Failed to send message");const V=await R.json();i([...h,V.message]),V.bondStrength!==void 0&&(f(V.bondStrength),I({...j,bondStrength:V.bondStrength})),V.linkMessage&&setTimeout(()=>{i(ae=>[...ae,{id:`link-${Date.now()}`,senderId:"link",content:V.linkMessage,timestamp:new Date().toISOString(),isLink:!0}])},1500)}catch(R){console.error("Send message error:",R),C.error("Failed to send message"),x(v)}finally{c(!1)}}},M=()=>{C.custom(v=>e.jsx(S,{className:"p-4 max-w-md bg-gradient-to-r from-pink-50 to-purple-50 border-pink-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-pink-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Bond Strength Unlocked!"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"You've reached a deep emotional connection. Ready to reveal who you both are?"}),e.jsx(y,{size:"sm",className:"w-full bg-gradient-to-r from-pink-500 to-purple-500",onClick:()=>{C.dismiss(v),q()},children:"Request Reveal"})]})]})}),{duration:1e4})},q=async()=>{try{const v=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/request-reveal`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({relationshipId:s.id})});if(!v.ok)throw new Error("Failed to request reveal");(await v.json()).revealed?(C.success("Both of you are ready! Revealing..."),setTimeout(()=>{r()},2e3)):C.success("Reveal request sent! Waiting for them to agree...")}catch(v){console.error("Request reveal error:",v),C.error("Failed to request reveal")}},D=(v=>v>=75?{label:"Deep Bond",color:"text-pink-600",bg:"bg-pink-100"}:v>=50?{label:"Growing Connection",color:"text-purple-600",bg:"bg-purple-100"}:v>=25?{label:"Building Trust",color:"text-blue-600",bg:"bg-blue-100"}:{label:"Getting to Know",color:"text-gray-600",bg:"bg-gray-100"})(p);return u?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-12 h-12 text-pink-500 mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-gray-600",children:"Loading your conversation..."})]})}):e.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-pink-100 px-4 py-3",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:l,children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-semibold text-gray-900",children:j.anonymousName||"Mystery Match"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Identities hidden â€¢ Guided by Link"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${D.bg} ${D.color}`,children:[e.jsx(te,{className:"w-3 h-3"}),D.label]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Bond Strength"}),e.jsxs("span",{className:"font-semibold text-purple-600",children:[p,"%"]})]}),e.jsx(oe,{value:p,className:"h-1.5"}),p<75&&e.jsx("p",{className:"text-xs text-gray-500",children:"Reach 75% to unlock reveal"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4",children:[h.map((v,R)=>{const V=v.senderId==="link"||v.isLink,ae=v.senderId===t.id;return V?e.jsx(Y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx(S,{className:"max-w-md p-3 bg-gradient-to-r from-blue-50 to-purple-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-blue-700 mb-1",children:"Link"}),e.jsx("p",{className:"text-sm text-gray-700",children:v.content})]})]})})},v.id||R):e.jsx(Y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${ae?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-md ${ae?"text-right":"text-left"}`,children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1 px-3",children:ae?"You":j.anonymousName||"Them"}),e.jsx("div",{className:`
                      inline-block px-4 py-3 rounded-2xl
                      ${ae?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"bg-white text-gray-900 border border-gray-200"}
                    `,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:v.content})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 px-3",children:new Date(v.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},v.id||R)}),e.jsx("div",{ref:B})]})}),e.jsx(Ie,{children:U&&L.length>0&&e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"px-4 py-3 bg-blue-50/80 backdrop-blur-sm border-t border-blue-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Link suggests asking:"})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>T(!1),className:"h-6",children:"Dismiss"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map((v,R)=>e.jsx(y,{variant:"outline",size:"sm",onClick:()=>{x(v),T(!1)},className:"text-xs bg-white hover:bg-blue-50 border-blue-200",children:v},R))})]})})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-t border-pink-100 px-4 py-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex gap-2",children:[!U&&L.length>0&&e.jsx(y,{variant:"outline",size:"icon",onClick:()=>T(!0),className:"flex-shrink-0",children:e.jsx(es,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx(X,{value:o,onChange:v=>x(v.target.value),onKeyDown:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),w(o))},placeholder:"Share your thoughts openly...",className:"pr-12",disabled:E})}),e.jsx(y,{onClick:()=>w(o),disabled:!o.trim()||E,className:"flex-shrink-0 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:e.jsx(fe,{className:"w-4 h-4"})})]}),p>=75&&!j.revealed&&e.jsx("div",{className:"mt-3",children:e.jsxs(y,{variant:"outline",size:"sm",onClick:q,className:"w-full border-pink-300 hover:bg-pink-50 text-pink-700",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Request to Reveal Identities"]})})]})})]})}function ka({relationship:s,userProfile:t,partnerProfile:a,accessToken:l,onContinueChat:r}){const[h,i]=d.useState(!1),[o,x]=d.useState(null),[u,k]=d.useState(!0);d.useEffect(()=>{setTimeout(()=>i(!0),1e3),E()},[]);const E=async()=>{try{const j=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/bond-report/${s.id}`,{headers:{Authorization:`Bearer ${l}`}});if(j.ok){const I=await j.json();x(I.report)}}catch(j){console.error("Load bond report error:",j)}finally{k(!1)}},c=o?.overallCompatibility||s.bondStrength||0;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[e.jsx(Ie,{children:!h&&e.jsx(Y.div,{initial:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-pink-500 to-purple-600",children:e.jsx("div",{className:"text-center text-white",children:e.jsxs(Y.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:[e.jsx(te,{className:"w-24 h-24 mx-auto mb-6"}),e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"The Reveal"}),e.jsx("p",{className:"text-xl text-white/90",children:"Showing who you both are..."})]})})})}),e.jsxs(Y.div,{initial:{opacity:0,y:20},animate:{opacity:h?1:0,y:h?0:20},transition:{delay:.5,duration:.6},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[e.jsx(O,{className:"w-8 h-8 text-pink-500"}),e.jsx(te,{className:"w-10 h-10 text-purple-500"}),e.jsx(O,{className:"w-8 h-8 text-pink-500"})]}),e.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent",children:"Your Bond Report"}),e.jsx("p",{className:"text-gray-600",children:"Based on your emotional connection and compatibility"})]}),e.jsxs(S,{className:"p-8 mb-6 bg-gradient-to-r from-pink-50 to-purple-50 border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-8 mb-6",children:[e.jsxs(Y.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{delay:1,duration:.5},className:"text-center",children:[e.jsxs(ne,{className:"w-24 h-24 mx-auto mb-3 border-4 border-white shadow-lg",children:[e.jsx(ee,{src:t.profilePicture||t.photos?.[0]}),e.jsx(se,{className:"bg-purple-200 text-purple-700 text-2xl",children:t.name?.[0]})]}),e.jsx("h3",{className:"font-semibold text-lg",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.school})]}),e.jsx(Y.div,{initial:{scale:0},animate:{scale:1},transition:{delay:1.5,type:"spring",stiffness:200},children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center",children:e.jsx(te,{className:"w-8 h-8 text-white fill-white"})})}),e.jsxs(Y.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{delay:1,duration:.5},className:"text-center",children:[e.jsxs(ne,{className:"w-24 h-24 mx-auto mb-3 border-4 border-white shadow-lg",children:[e.jsx(ee,{src:a.profilePicture||a.photos?.[0]}),e.jsx(se,{className:"bg-pink-200 text-pink-700 text-2xl",children:a.name?.[0]})]}),e.jsx("h3",{className:"font-semibold text-lg",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.school})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-gray-700 mb-2",children:["You matched with ",e.jsx("span",{className:"font-semibold text-purple-600",children:a.name})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"You connected through emotional depth, not just appearance"})]})]}),e.jsxs(S,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Overall Compatibility"}),e.jsx("div",{className:"relative inline-block",children:e.jsxs(Y.div,{initial:{scale:0},animate:{scale:1},transition:{delay:2,type:"spring"},className:"text-6xl font-bold bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent",children:[c,"%"]})})]}),e.jsx(oe,{value:c,className:"h-3 mb-2"}),e.jsx("p",{className:"text-center text-sm text-gray-600",children:c>=80?"Exceptional Match":c>=60?"Strong Connection":c>=40?"Good Potential":"Growing Together"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs(S,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Emotional Compatibility"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o?.emotionalCompatibility||c,"%"]})]})]}),e.jsx(oe,{value:o?.emotionalCompatibility||c,className:"mb-2"}),e.jsx("p",{className:"text-xs text-gray-600",children:o?.emotionalInsight||"Your emotional connection shows strong mutual understanding and empathy."})]}),e.jsxs(S,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-pink-100 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-pink-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Communication Style"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o?.communicationScore||Math.max(70,c-10),"%"]})]})]}),e.jsx(oe,{value:o?.communicationScore||Math.max(70,c-10),className:"mb-2"}),e.jsx("p",{className:"text-xs text-gray-600",children:o?.communicationInsight||"You both communicate openly and effectively with each other."})]}),e.jsxs(S,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(hs,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Value Alignment"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o?.valueAlignment||Math.max(65,c-15),"%"]})]})]}),e.jsx(oe,{value:o?.valueAlignment||Math.max(65,c-15),className:"mb-2"}),e.jsx("p",{className:"text-xs text-gray-600",children:o?.valuesInsight||"You share important core values and life priorities."})]}),e.jsxs(S,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Attachment Compatibility"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o?.attachmentCompatibility||Math.max(60,c-20),"%"]})]})]}),e.jsx(oe,{value:o?.attachmentCompatibility||Math.max(60,c-20),className:"mb-2"}),e.jsx("p",{className:"text-xs text-gray-600",children:o?.attachmentInsight||"Your attachment styles complement each other well."})]})]}),e.jsxs(S,{className:"p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-green-500"}),"Your Connection Strengths"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:(o?.strengths||["Deep emotional connection","Open and authentic communication","Mutual respect and understanding","Shared emotional intelligence","Natural conversation flow","Compatible values and goals"]).map((j,I)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:j})]},I))})]}),o?.growthAreas&&o.growthAreas.length>0&&e.jsxs(S,{className:"p-6 mb-6 bg-blue-50",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ft,{className:"w-5 h-5 text-blue-500"}),"Areas to Explore Together"]}),e.jsx("div",{className:"space-y-2",children:o.growthAreas.map((j,I)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-700",children:j})]},I))})]}),e.jsx(S,{className:"p-6 mb-6 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0",children:e.jsx(_e,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-purple-900 mb-2",children:"Link's Insight"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:o?.linkInsight||"What makes your connection special is how you both prioritized emotional depth over surface attraction. Through your conversations, you've shown genuine curiosity, vulnerability, and empathy. This foundationâ€”built on who you truly areâ€”creates a more meaningful and lasting bond than visual chemistry alone."})]})]})}),e.jsxs(S,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"What's Next?"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ue,{className:"w-5 h-5 text-purple-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Continue your conversation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Now that you know each other, keep building your connection"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(te,{className:"w-5 h-5 text-pink-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Take it to the next level"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Plan a real date to meet in person"})]})]})]}),e.jsxs(y,{onClick:r,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-lg py-6",children:["Continue Chatting with ",a.name]})]})]})]})})}function Sa({userProfile:s,accessToken:t,onExit:a}){const[l,r]=d.useState(!1),[h,i]=d.useState(!0),[o,x]=d.useState("onboarding"),[u,k]=d.useState([]),[E,c]=d.useState(null),[j,I]=d.useState(null);d.useEffect(()=>{L()},[]);const L=async()=>{try{const n=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/activation-status`,{headers:{Authorization:`Bearer ${t}`}});if(n.ok){const g=await n.json();r(g.isActivated||!1),g.isActivated&&(s.lovePrint?(x("matches"),p()):x("lovePrintQuiz"))}else r(!1)}catch(n){console.error("Check activation error:",n),r(!1)}finally{i(!1)}},$=async()=>{try{if((await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/activate`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok)r(!0),s.lovePrint?x("rating"):x("lovePrintQuiz"),C.success("Welcome to Love Mode! ðŸ’œ"),p();else throw new Error("Failed to activate")}catch(n){console.error("Activate Love Mode error:",n),C.error("Failed to activate Love Mode")}},U=async n=>{try{(await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/love-print`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({lovePrint:n})})).ok&&(C.success("Love Print complete! Now let's find your matches."),x("rating"))}catch(g){console.error("Save Love Print error:",g),C.error("Failed to save Love Print")}},T=()=>{x("rating")},p=async()=>{try{const n=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/relationships`,{headers:{Authorization:`Bearer ${t}`}});if(n.ok){const g=await n.json();k(g.relationships||[])}}catch(n){console.error("Load relationships error:",n)}},f=()=>{p(),x("matches")},B=async n=>{c(n),n.revealed&&await b(n.partnerId),x("chat")},b=async n=>{try{const g=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/profile/${n}`,{headers:{Authorization:`Bearer ${t}`}});if(g.ok){const w=await g.json();I(w)}}catch(g){console.error("Load partner profile error:",g)}},F=async()=>{try{const n=await fetch(`https://${W}.supabase.co/functions/v1/make-server-2516be19/love-mode/relationships`,{headers:{Authorization:`Bearer ${t}`}});if(n.ok){const w=(await n.json()).relationships.find(M=>M.id===E.id);w?.revealed&&(await b(w.partnerId),c(w),x("reveal"))}}catch(n){console.error("Check reveal status error:",n)}};return h?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-pink-50 to-purple-50",children:e.jsx(O,{className:"w-12 h-12 text-pink-500 animate-pulse"})}):l?o==="lovePrintQuiz"?e.jsx(ya,{onComplete:U,onSkip:T}):o==="rating"?e.jsx(va,{userProfile:s,accessToken:t,onRatingComplete:f}):o==="chat"&&E?e.jsx(wa,{relationship:E,userProfile:s,accessToken:t,onBack:()=>{c(null),x("matches"),p()},onRevealRequested:F}):o==="reveal"&&E&&j?e.jsx(ka,{relationship:E,userProfile:s,partnerProfile:j,accessToken:t,onContinueChat:()=>x("chat")}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-pink-100 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{variant:"ghost",size:"icon",onClick:a,children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-pink-500"}),e.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent",children:"Love Mode"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Where hearts connect first"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>x("rating"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Rate More"]})})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:u.length===0?e.jsxs(S,{className:"p-12 text-center",children:[e.jsx(te,{className:"w-16 h-16 text-pink-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Matches Yet"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Keep rating profiles to help our AI understand your type.",e.jsx("br",{}),"We'll notify you when you have a match!"]}),e.jsxs(y,{onClick:()=>x("rating"),className:"bg-gradient-to-r from-pink-500 to-purple-500",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Start Rating"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your Connections"}),u.map(n=>e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(S,{className:"p-6 cursor-pointer hover:shadow-lg transition-all border-2 hover:border-pink-200",onClick:()=>B(n),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[n.revealed?e.jsxs(ne,{className:"w-16 h-16 border-2 border-pink-200",children:[e.jsx(ee,{src:n.partnerPhoto}),e.jsx(se,{className:"bg-pink-100 text-pink-700",children:n.partnerName?.[0]})]}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-r from-pink-200 to-purple-200 flex items-center justify-center",children:e.jsx(Ee,{className:"w-8 h-8 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:n.revealed?n.partnerName:n.anonymousName||"Mystery Match"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(K,{variant:"secondary",className:`text-xs ${n.bondStrength>=75?"bg-pink-100 text-pink-700":n.bondStrength>=50?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:["Bond: ",n.bondStrength,"%"]}),n.unreadCount>0&&e.jsxs(K,{className:"bg-red-500 text-white",children:[n.unreadCount," new"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[n.revealed?e.jsx(Pe,{className:"w-6 h-6 text-pink-500"}):e.jsx(Ee,{className:"w-6 h-6 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:n.lastMessage?new Date(n.lastMessageAt).toLocaleDateString():"Start chatting"})]})]})})},n.id))]})})]}):e.jsx(ba,{onActivate:$})}function Ca(s,t={}){if(!s)return"/Bonded_transparent_icon.png";if(s.includes("supabase.co/storage")){const a=new URLSearchParams;t.width&&a.append("width",t.width.toString()),t.height&&a.append("height",t.height.toString()),t.quality&&a.append("quality",t.quality.toString()),t.format&&a.append("format",t.format);const l=s.includes("?")?"&":"?";return`${s}${l}${a.toString()}`}return s.startsWith("data:")||s.startsWith("http"),s}function Aa(s,t="medium"){return Ca(s,{...{small:{width:100,height:100},medium:{width:400,height:400},large:{width:800,height:800}}[t],quality:80,format:"webp"})}function Ea(s,t=""){return{src:s,alt:t,loading:"lazy",decoding:"async",onError:a=>{a.target.src="/Bonded_transparent_icon.png"}}}function Ua({userProfile:s,accessToken:t,onLogout:a}){const[l,r]=d.useState("discover"),[h,i]=d.useState("friend"),[o,x]=d.useState(!1),u=Ce("LOVE_MODE_ENABLED");if(u&&h==="love")return e.jsx(Sa,{userProfile:s,accessToken:t,onExit:()=>i("friend")});const k=Aa(s?.profilePicture||s?.photos?.[0],"small");return e.jsxs("div",{className:"fixed inset-0 flex flex-col bg-white",style:{height:"100dvh",overflow:"hidden"},children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-white border-b border-[#EAEAEA] px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>r("profile"),className:"flex items-center gap-2 focus:outline-none",children:e.jsx("img",{...Ea(k,s?.name||"Profile"),className:"w-10 h-10 rounded-full object-cover border-2 border-[#2E7B91]"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/Bonded_transparent_icon.png",alt:"bonded logo",className:"w-6 h-6"}),e.jsx("h1",{className:"text-xl text-[#1E4F74] lowercase font-bold tracking-wide",children:"bonded"})]}),e.jsx("div",{className:"w-10 h-10"})]}),u&&e.jsx(ja,{mode:h,onChange:i}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(Vt,{activeTab:l,onTabChange:r,accessToken:t,hideNavigation:o,children:[l==="discover"&&e.jsx(da,{userProfile:s,accessToken:t,onProfileDetailOpen:x}),l==="matches"&&e.jsx(ua,{userProfile:s,accessToken:t}),l==="messages"&&e.jsx(xa,{userProfile:s,accessToken:t}),l==="profile"&&e.jsx(fa,{userProfile:s,accessToken:t,onLogout:a})]})})]})}export{Ua as MainApp};
